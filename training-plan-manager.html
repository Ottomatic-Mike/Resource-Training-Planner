<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training Plan Manager</title>
    <meta name="description" content="AI-assisted training plan manager for engineering teams">
    <meta name="author" content="Training Plan Manager">

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<style>
/* ============================================================================
   TRAINING PLAN MANAGER - CSS DESIGN SYSTEM
   ============================================================================ */

/* === ROOT VARIABLES === */
:root {
    /* Colors - Teal/Green Theme */
    --primary-color: #044d4b;
    --primary-light: #056663;
    --primary-dark: #033d3b;
    --secondary-color: #81b5a1;
    --secondary-light: #a3c9b8;
    --secondary-dark: #5f9a84;

    /* Neutrals */
    --neutral-50: #f8fafc;
    --neutral-100: #f1f5f9;
    --neutral-200: #e2e8f0;
    --neutral-300: #cbd5e1;
    --neutral-400: #94a3b8;
    --neutral-500: #64748b;
    --neutral-600: #475569;
    --neutral-700: #334155;
    --neutral-800: #1e293b;
    --neutral-900: #0f172a;

    /* Status Colors */
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --error-color: #ef4444;
    --info-color: #3b82f6;

    /* Backgrounds */
    --bg-page: #f8fafc;
    --bg-card: #ffffff;
    --bg-hover: #f1f5f9;
    --bg-selected: #e0f2f1;

    /* Text */
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --text-muted: #94a3b8;
    --text-inverse: #ffffff;

    /* Borders */
    --border-light: #e2e8f0;
    --border-medium: #cbd5e1;
    --border-dark: #94a3b8;

    /* Shadows */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);

    /* Spacing */
    --spacing-xs: 4px;
    --spacing-sm: 8px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;

    /* Border Radius */
    --radius-sm: 4px;
    --radius-md: 6px;
    --radius-lg: 8px;
    --radius-xl: 12px;

    /* Typography */
    --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    --font-mono: 'Monaco', 'Courier New', monospace;
}

/* === RESET & BASE === */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: var(--font-family);
    font-size: 14px;
    line-height: 1.6;
    color: var(--text-primary);
    background: var(--bg-page);
    overflow-x: hidden;
}

/* === LAYOUT === */
.app-container {
    max-width: 1600px;
    margin: 0 auto;
    padding: 20px;
}

.header {
    background: var(--primary-color);
    color: var(--text-inverse);
    padding: 20px 30px;
    margin: -20px -20px 20px -20px;
    border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    box-shadow: var(--shadow-md);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 15px;
}

.app-title {
    font-size: 24px;
    font-weight: 600;
    margin: 0;
}

.app-subtitle {
    font-size: 13px;
    color: var(--secondary-light);
    margin: 0;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 12px;
}

.save-indicator {
    font-size: 12px;
    color: var(--secondary-light);
    padding: 6px 12px;
    border-radius: var(--radius-md);
    background: rgba(255, 255, 255, 0.1);
}

.save-indicator.saving {
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}

/* === GRID SYSTEM === */
.grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.grid-3 {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 15px;
}

.grid-4 {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
}

.grid-auto {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 15px;
}

/* === CARDS === */
.card {
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
    padding: 20px;
    box-shadow: var(--shadow-sm);
    transition: box-shadow 0.2s, transform 0.2s;
}

.card:hover {
    box-shadow: var(--shadow-md);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-light);
}

.card-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.card-subtitle {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 4px;
}

.card-body {
    color: var(--text-secondary);
}

.card-actions {
    display: flex;
    gap: 8px;
    margin-top: 15px;
    padding-top: 12px;
    border-top: 1px solid var(--border-light);
}

/* Metric Cards */
.metric-card {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
    color: var(--text-inverse);
    border: none;
}

.metric-value {
    font-size: 32px;
    font-weight: 700;
    line-height: 1;
    margin: 10px 0;
}

.metric-label {
    font-size: 13px;
    opacity: 0.9;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.metric-change {
    font-size: 12px;
    margin-top: 8px;
    padding: 4px 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-sm);
    display: inline-block;
}

/* === BUTTONS === */
.btn {
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 500;
    border: none;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    white-space: nowrap;
}

.btn:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.btn:active {
    transform: translateY(0);
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.btn-primary {
    background: var(--primary-color);
    color: var(--text-inverse);
}

.btn-primary:hover {
    background: var(--primary-light);
}

.btn-secondary {
    background: var(--secondary-color);
    color: var(--text-inverse);
}

.btn-secondary:hover {
    background: var(--secondary-dark);
}

.btn-success {
    background: var(--success-color);
    color: var(--text-inverse);
}

.btn-warning {
    background: var(--warning-color);
    color: var(--text-inverse);
}

.btn-error {
    background: var(--error-color);
    color: var(--text-inverse);
}

.btn-outline {
    background: transparent;
    border: 2px solid var(--primary-color);
    color: var(--primary-color);
}

.btn-outline:hover {
    background: var(--primary-color);
    color: var(--text-inverse);
}

.btn-ghost {
    background: transparent;
    color: var(--text-secondary);
}

.btn-ghost:hover {
    background: var(--bg-hover);
}

.btn-sm {
    padding: 6px 12px;
    font-size: 12px;
}

.btn-lg {
    padding: 14px 28px;
    font-size: 16px;
}

.btn-icon {
    padding: 8px;
    aspect-ratio: 1;
}

/* === TAB NAVIGATION === */
.tab-navigation {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    background: var(--bg-card);
    padding: 10px;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    overflow-x: auto;
}

.tab-button {
    padding: 12px 20px;
    font-size: 14px;
    font-weight: 500;
    background: transparent;
    border: none;
    border-radius: var(--radius-md);
    cursor: pointer;
    color: var(--text-secondary);
    transition: all 0.2s;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 8px;
}

.tab-button:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
}

.tab-button.active {
    background: var(--primary-color);
    color: var(--text-inverse);
}

.section-number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 50%;
    font-size: 12px;
    font-weight: 600;
}

.tab-button.active .section-number {
    background: rgba(255, 255, 255, 0.2);
}

.tab-content {
    display: none;
    animation: fadeIn 0.3s ease-in;
}

.tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* === TABLES === */
.table-container {
    overflow-x: auto;
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-light);
}

table {
    width: 100%;
    border-collapse: collapse;
    background: var(--bg-card);
}

thead {
    background: var(--neutral-50);
}

th {
    padding: 12px 16px;
    text-align: left;
    font-weight: 600;
    font-size: 13px;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid var(--border-light);
}

td {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-light);
    color: var(--text-primary);
}

tr:last-child td {
    border-bottom: none;
}

tbody tr:hover {
    background: var(--bg-hover);
}

.table-actions {
    display: flex;
    gap: 8px;
}

/* === FORMS === */
.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    font-size: 13px;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 6px;
}

.form-label-required::after {
    content: ' *';
    color: var(--error-color);
}

.form-input,
.form-select,
.form-textarea {
    width: 100%;
    padding: 10px 12px;
    font-size: 14px;
    font-family: var(--font-family);
    border: 1px solid var(--border-medium);
    border-radius: var(--radius-md);
    background: var(--bg-card);
    color: var(--text-primary);
    transition: border-color 0.2s, box-shadow 0.2s;
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(4, 77, 75, 0.1);
}

.form-input:disabled,
.form-select:disabled,
.form-textarea:disabled {
    background: var(--neutral-100);
    cursor: not-allowed;
}

.form-textarea {
    min-height: 100px;
    resize: vertical;
}

.form-help {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 4px;
}

.form-error {
    font-size: 12px;
    color: var(--error-color);
    margin-top: 4px;
}

.form-inline {
    display: flex;
    gap: 12px;
    align-items: flex-end;
}

.form-inline .form-group {
    flex: 1;
    margin-bottom: 0;
}

/* Checkbox & Radio */
.form-checkbox,
.form-radio {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    padding: 8px 0;
}

.form-checkbox input[type="checkbox"],
.form-radio input[type="radio"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

/* === MODALS === */
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    animation: fadeIn 0.2s;
}

.modal-overlay.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.3s;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-large {
    max-width: 900px;
}

.modal-header {
    padding: 24px;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-title {
    font-size: 20px;
    font-weight: 600;
    margin: 0;
}

.modal-close {
    background: none;
    border: none;
    font-size: 24px;
    color: var(--text-muted);
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-md);
}

.modal-close:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
}

.modal-body {
    padding: 24px;
}

.modal-footer {
    padding: 24px;
    border-top: 1px solid var(--border-light);
    display: flex;
    justify-content: flex-end;
    gap: 12px;
}

/* === BADGES === */
.badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    font-size: 12px;
    font-weight: 500;
    border-radius: 12px;
    white-space: nowrap;
}

.badge-primary {
    background: var(--primary-color);
    color: var(--text-inverse);
}

.badge-secondary {
    background: var(--secondary-color);
    color: var(--text-inverse);
}

.badge-success {
    background: #d1fae5;
    color: #065f46;
}

.badge-warning {
    background: #fef3c7;
    color: #92400e;
}

.badge-error {
    background: #fee2e2;
    color: #991b1b;
}

.badge-info {
    background: #dbeafe;
    color: #1e40af;
}

.badge-neutral {
    background: var(--neutral-200);
    color: var(--text-secondary);
}

/* === PROGRESS BARS === */
.progress-bar {
    height: 8px;
    background: var(--neutral-200);
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: var(--primary-color);
    transition: width 0.3s;
    border-radius: 4px;
}

.progress-bar-success .progress-fill {
    background: var(--success-color);
}

.progress-bar-warning .progress-fill {
    background: var(--warning-color);
}

.progress-bar-error .progress-fill {
    background: var(--error-color);
}

/* Progress with label */
.progress-labeled {
    display: flex;
    align-items: center;
    gap: 12px;
}

.progress-labeled .progress-bar {
    flex: 1;
}

.progress-label {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
    min-width: 40px;
    text-align: right;
}

/* === ALERTS === */
.alert {
    padding: 16px;
    border-radius: var(--radius-md);
    margin-bottom: 16px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
}

.alert-success {
    background: #d1fae5;
    color: #065f46;
    border-left: 4px solid var(--success-color);
}

.alert-warning {
    background: #fef3c7;
    color: #92400e;
    border-left: 4px solid var(--warning-color);
}

.alert-error {
    background: #fee2e2;
    color: #991b1b;
    border-left: 4px solid var(--error-color);
}

.alert-info {
    background: #dbeafe;
    color: #1e40af;
    border-left: 4px solid var(--info-color);
}

/* === WIZARD === */
.wizard-container {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 30px;
    box-shadow: var(--shadow-md);
}

.wizard-header {
    text-align: center;
    margin-bottom: 30px;
}

.wizard-title {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 8px;
}

.wizard-subtitle {
    font-size: 14px;
    color: var(--text-muted);
}

.wizard-progress {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 30px 0;
    position: relative;
}

.wizard-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    flex: 1;
}

.wizard-step-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--neutral-200);
    color: var(--text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 16px;
    position: relative;
    z-index: 2;
}

.wizard-step.active .wizard-step-circle {
    background: var(--primary-color);
    color: var(--text-inverse);
}

.wizard-step.completed .wizard-step-circle {
    background: var(--success-color);
    color: var(--text-inverse);
}

.wizard-step-label {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 8px;
    text-align: center;
}

.wizard-step.active .wizard-step-label {
    color: var(--primary-color);
    font-weight: 600;
}

.wizard-step-line {
    position: absolute;
    top: 20px;
    left: 50%;
    right: -50%;
    height: 2px;
    background: var(--neutral-200);
    z-index: 1;
}

.wizard-step.completed .wizard-step-line {
    background: var(--success-color);
}

.wizard-step:last-child .wizard-step-line {
    display: none;
}

.wizard-content {
    min-height: 400px;
    margin: 30px 0;
}

.wizard-navigation {
    display: flex;
    justify-content: space-between;
    padding-top: 20px;
    border-top: 1px solid var(--border-light);
}

/* === LISTS === */
.list-group {
    list-style: none;
    border-radius: var(--radius-lg);
    overflow: hidden;
    border: 1px solid var(--border-light);
}

.list-item {
    padding: 16px;
    background: var(--bg-card);
    border-bottom: 1px solid var(--border-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background 0.2s;
}

.list-item:last-child {
    border-bottom: none;
}

.list-item:hover {
    background: var(--bg-hover);
}

.list-item-title {
    font-weight: 500;
    color: var(--text-primary);
}

.list-item-subtitle {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 4px;
}

/* === EMPTY STATES === */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-muted);
}

.empty-state-icon {
    font-size: 64px;
    margin-bottom: 16px;
    opacity: 0.3;
}

.empty-state-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 8px;
}

.empty-state-description {
    font-size: 14px;
    margin-bottom: 20px;
}

/* === UTILITIES === */
.text-center { text-align: center; }
.text-left { text-align: left; }
.text-right { text-align: right; }

.text-primary { color: var(--text-primary); }
.text-secondary { color: var(--text-secondary); }
.text-muted { color: var(--text-muted); }
.text-success { color: var(--success-color); }
.text-warning { color: var(--warning-color); }
.text-error { color: var(--error-color); }

.font-bold { font-weight: 600; }
.font-normal { font-weight: 400; }

.mb-0 { margin-bottom: 0; }
.mb-1 { margin-bottom: var(--spacing-sm); }
.mb-2 { margin-bottom: var(--spacing-md); }
.mb-3 { margin-bottom: var(--spacing-lg); }

.mt-0 { margin-top: 0; }
.mt-1 { margin-top: var(--spacing-sm); }
.mt-2 { margin-top: var(--spacing-md); }
.mt-3 { margin-top: var(--spacing-lg); }

.hidden { display: none; }
.block { display: block; }
.inline-block { display: inline-block; }
.flex { display: flex; }

.flex-center {
    display: flex;
    align-items: center;
    justify-content: center;
}

.gap-sm { gap: var(--spacing-sm); }
.gap-md { gap: var(--spacing-md); }
.gap-lg { gap: var(--spacing-lg); }

/* === LOADING SPINNER === */
.spinner {
    border: 3px solid var(--neutral-200);
    border-top: 3px solid var(--primary-color);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
}

.spinner-sm {
    width: 20px;
    height: 20px;
    border-width: 2px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* === RESPONSIVE === */
@media (max-width: 768px) {
    .grid-2,
    .grid-3,
    .grid-4 {
        grid-template-columns: 1fr;
    }

    .tab-navigation {
        overflow-x: scroll;
    }

    .wizard-progress {
        flex-wrap: wrap;
    }

    .form-inline {
        flex-direction: column;
    }

    .form-inline .form-group {
        width: 100%;
    }
}

/* === QUICK ACTIONS === */
.quick-actions {
    display: flex;
    gap: 12px;
    padding: 20px;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    margin-bottom: 20px;
    flex-wrap: wrap;
}

/* === SEARCH & FILTER BAR === */
.search-filter-bar {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.search-input {
    flex: 1;
    min-width: 250px;
}

/* === STATUS INDICATORS === */
.status-dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 6px;
}

.status-dot.success { background: var(--success-color); }
.status-dot.warning { background: var(--warning-color); }
.status-dot.error { background: var(--error-color); }
.status-dot.info { background: var(--info-color); }
.status-dot.neutral { background: var(--neutral-400); }

/* === LEVEL INDICATORS === */
.level-indicator {
    display: inline-flex;
    gap: 2px;
}

.level-box {
    width: 12px;
    height: 12px;
    background: var(--neutral-200);
    border-radius: 2px;
}

.level-box.filled {
    background: var(--primary-color);
}
</style>

<body>
    <!-- Application Container -->
    <div class="app-container">

        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div>
                    <h1 class="app-title">Training Plan Manager</h1>
                    <p class="app-subtitle">AI-Assisted Training Planning for Engineering Teams</p>
                </div>
            </div>
            <div class="header-right">
                <span class="save-indicator" id="saveIndicator">Saved</span>
                <button class="btn btn-ghost" onclick="openSettings()" style="color: white;">⚙️ Settings</button>
                <button class="btn btn-ghost" onclick="showHelp()" style="color: white;">❓ Help</button>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab(1)">
                <span class="section-number">1</span> Dashboard
            </button>
            <button class="tab-button" onclick="switchTab(2)">
                <span class="section-number">2</span> Resources
            </button>
            <button class="tab-button" onclick="switchTab(3)">
                <span class="section-number">3</span> Competencies
            </button>
            <button class="tab-button" onclick="switchTab(4)">
                <span class="section-number">4</span> Course Catalog
            </button>
            <button class="tab-button" onclick="switchTab(5)">
                <span class="section-number">5</span> Training Plans
            </button>
            <button class="tab-button" onclick="switchTab(6)">
                <span class="section-number">6</span> Calendars
            </button>
            <button class="tab-button" onclick="switchTab(7)">
                <span class="section-number">7</span> Reports
            </button>
        </div>

        <!-- Tab 1: Dashboard -->
        <div id="tab-1" class="tab-content active">
            <div id="dashboardContent"></div>
        </div>

        <!-- Tab 2: Resources -->
        <div id="tab-2" class="tab-content">
            <div id="resourcesContent"></div>
        </div>

        <!-- Tab 3: Competency Library -->
        <div id="tab-3" class="tab-content">
            <div id="competenciesContent"></div>
        </div>

        <!-- Tab 4: Course Catalog -->
        <div id="tab-4" class="tab-content">
            <div id="coursesContent"></div>
        </div>

        <!-- Tab 5: Training Plans -->
        <div id="tab-5" class="tab-content">
            <div id="trainingPlansContent"></div>
        </div>

        <!-- Tab 6: Calendar Management -->
        <div id="tab-6" class="tab-content">
            <div id="calendarsContent"></div>
        </div>

        <!-- Tab 7: Reports & Analytics -->
        <div id="tab-7" class="tab-content">
            <div id="reportsContent"></div>
        </div>

    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal modal-large">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
                <button class="modal-close" onclick="closeSettings()">×</button>
            </div>
            <div class="modal-body" id="settingsContent"></div>
            <div class="modal-footer">
                <button class="btn btn-ghost" onclick="closeSettings()">Cancel</button>
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- General Purpose Modal -->
    <div id="generalModal" class="modal-overlay">
        <div class="modal" id="generalModalInner">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Modal</h2>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer" id="modalFooter"></div>
        </div>
    </div>

    <!-- File input for imports (hidden) -->
    <input type="file" id="fileInput" accept=".json" style="display: none;">

<script>
// ============================================================================
// TRAINING PLAN MANAGER - JAVASCRIPT
// ============================================================================

// === GLOBAL STATE VARIABLES ===
let resources = [];
let competencyLibrary = [];
let courseCatalog = [];
let regionalCalendars = [];
let trainingPlans = [];
let settings = {
    aiProvider: 'anthropic',
    aiModel: 'claude-3-5-sonnet-20241022',
    apiKey: '',
    aiTemperature: 0.7,
    theme: 'light',
    dateFormat: 'MM/DD/YYYY',
    currency: 'USD',
    currencySymbol: '$',
    defaultWeeklyHours: 5,
    defaultBudget: 5000,
    defaultLearningPace: 'Moderate',
    defaultRegionalCalendar: '',
    autoSaveEnabled: true,
    autoSaveInterval: 2000,
    confirmBeforeDelete: true,
    showTooltips: true,
    lastBackup: null,
    autoBackupEnabled: false,
    backupFrequencyDays: 7
};

let nextResourceId = 1;
let nextCompetencyId = 1;
let nextCourseId = 1;
let nextCalendarId = 1;
let nextPlanId = 1;
let activeTab = 1;
let saveTimeout = null;

const STORAGE_KEY = 'trainingPlanManager_autoSave';
const ACTIVE_TAB_KEY = 'trainingPlanManager_activeTab';

// Wizard state
let wizardState = {
    active: false,
    currentStep: 1,
    totalSteps: 6,
    data: {}
};

// === INITIALIZATION ===
document.addEventListener('DOMContentLoaded', function() {
    checkLibrariesAndInitialize();
});

function checkLibrariesAndInitialize() {
    // Check if libraries loaded
    if (typeof Chart === 'undefined' || typeof Sortable === 'undefined' || typeof XLSX === 'undefined') {
        alert('Required libraries failed to load. Please check your internet connection and refresh.');
        return;
    }

    initializeApplication();
}

function initializeApplication() {
    // Try to load saved data
    const hasData = loadFromLocalStorage();

    if (!hasData) {
        // Load sample data for first-time users
        loadSampleData();
    }

    // Restore active tab
    const savedTab = localStorage.getItem(ACTIVE_TAB_KEY);
    if (savedTab) {
        activeTab = parseInt(savedTab);
        switchTab(activeTab);
    }

    // Render all views
    renderAllViews();

    // Setup auto-save
    if (settings.autoSaveEnabled) {
        setInterval(autoSave, settings.autoSaveInterval);
    }
}

// === TAB SWITCHING ===
function switchTab(tabNumber) {
    // Remove active class from all tabs
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');

    tabButtons.forEach(btn => btn.classList.remove('active'));
    tabContents.forEach(content => content.classList.remove('active'));

    // Add active class to selected tab
    const activeButton = tabButtons[tabNumber - 1];
    const activeContent = document.getElementById(`tab-${tabNumber}`);

    if (activeButton) activeButton.classList.add('active');
    if (activeContent) activeContent.classList.add('active');

    activeTab = tabNumber;
    localStorage.setItem(ACTIVE_TAB_KEY, activeTab);

    // Render the active tab
    renderActiveTab();
}

function renderActiveTab() {
    switch(activeTab) {
        case 1: renderDashboard(); break;
        case 2: renderResources(); break;
        case 3: renderCompetencies(); break;
        case 4: renderCourses(); break;
        case 5: renderTrainingPlans(); break;
        case 6: renderCalendars(); break;
        case 7: renderReports(); break;
    }
}

function renderAllViews() {
    renderDashboard();
    renderResources();
    renderCompetencies();
    renderCourses();
    renderTrainingPlans();
    renderCalendars();
    renderReports();
}

// === SAVE/LOAD FUNCTIONS ===
function autoSave() {
    saveToLocalStorage();
}

function saveToLocalStorage() {
    const saveData = {
        version: '1.0.0',
        savedDate: new Date().toISOString(),
        resources: resources,
        competencyLibrary: competencyLibrary,
        courseCatalog: courseCatalog,
        regionalCalendars: regionalCalendars,
        trainingPlans: trainingPlans,
        settings: settings,
        nextResourceId: nextResourceId,
        nextCompetencyId: nextCompetencyId,
        nextCourseId: nextCourseId,
        nextCalendarId: nextCalendarId,
        nextPlanId: nextPlanId
    };

    try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(saveData));
        showSaveIndicator('Saved');
    } catch (e) {
        console.error('Failed to save:', e);
        showSaveIndicator('Save failed', true);
    }
}

function loadFromLocalStorage() {
    try {
        const savedData = localStorage.getItem(STORAGE_KEY);
        if (!savedData) return false;

        const data = JSON.parse(savedData);

        resources = data.resources || [];
        competencyLibrary = data.competencyLibrary || [];
        courseCatalog = data.courseCatalog || [];
        regionalCalendars = data.regionalCalendars || [];
        trainingPlans = data.trainingPlans || [];
        settings = { ...settings, ...(data.settings || {}) };

        nextResourceId = data.nextResourceId || 1;
        nextCompetencyId = data.nextCompetencyId || 1;
        nextCourseId = data.nextCourseId || 1;
        nextCalendarId = data.nextCalendarId || 1;
        nextPlanId = data.nextPlanId || 1;

        return true;
    } catch (e) {
        console.error('Failed to load:', e);
        return false;
    }
}

function showSaveIndicator(message, isError = false) {
    const indicator = document.getElementById('saveIndicator');
    if (!indicator) return;

    indicator.textContent = message;
    indicator.classList.toggle('saving', message === 'Saving...');

    if (isError) {
        indicator.style.background = 'rgba(239, 68, 68, 0.2)';
    } else {
        indicator.style.background = 'rgba(255, 255, 255, 0.1)';
    }
}

function triggerSave() {
    showSaveIndicator('Saving...');
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
        saveToLocalStorage();
    }, 500);
}

// === UTILITY FUNCTIONS ===
function generateId() {
    return `id_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
}

function formatDate(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const year = date.getFullYear();

    if (settings.dateFormat === 'DD/MM/YYYY') {
        return `${day}/${month}/${year}`;
    }
    return `${month}/${day}/${year}`;
}

function formatCurrency(amount) {
    if (amount === null || amount === undefined) return settings.currencySymbol + '0';
    return settings.currencySymbol + amount.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
}

function getLevelName(level) {
    const names = {
        1: 'Awareness',
        2: 'Beginner',
        3: 'Intermediate',
        4: 'Advanced',
        5: 'Expert'
    };
    return names[level] || '';
}

function getLevelIndicator(level) {
    let html = '<div class="level-indicator">';
    for (let i = 1; i <= 5; i++) {
        html += `<div class="level-box ${i <= level ? 'filled' : ''}"></div>`;
    }
    html += '</div>';
    return html;
}

function getStatusBadge(status) {
    const statusMap = {
        'Planned': 'badge-neutral',
        'In Progress': 'badge-info',
        'Completed': 'badge-success',
        'Deferred': 'badge-warning',
        'Cancelled': 'badge-error',
        'On Track': 'badge-success',
        'At Risk': 'badge-warning',
        'Behind': 'badge-error'
    };

    const badgeClass = statusMap[status] || 'badge-neutral';
    return `<span class="badge ${badgeClass}">${status}</span>`;
}

function getStatusDot(status) {
    const colorMap = {
        'Planned': 'neutral',
        'In Progress': 'info',
        'Completed': 'success',
        'Deferred': 'warning',
        'Cancelled': 'error',
        'On Track': 'success',
        'At Risk': 'warning',
        'Behind': 'error'
    };

    const color = colorMap[status] || 'neutral';
    return `<span class="status-dot ${color}"></span>`;
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// === MODAL FUNCTIONS ===
function openModal(title, bodyHtml, footerHtml = '', modalClass = '') {
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalBody').innerHTML = bodyHtml;
    document.getElementById('modalFooter').innerHTML = footerHtml || '<button class="btn btn-ghost" onclick="closeModal()">Close</button>';

    const modalInner = document.getElementById('generalModalInner');
    // Remove any previous size classes
    modalInner.classList.remove('modal-large', 'modal-small');
    // Add the specified class if provided
    if (modalClass) {
        modalInner.classList.add(modalClass);
    }

    document.getElementById('generalModal').classList.add('active');
}

function closeModal() {
    document.getElementById('generalModal').classList.remove('active');
}

// === SETTINGS FUNCTIONS ===
function openSettings() {
    const html = `
        <div class="form-group">
            <label class="form-label">AI Provider</label>
            <select class="form-select" id="settingAiProvider">
                <option value="anthropic" ${settings.aiProvider === 'anthropic' ? 'selected' : ''}>Anthropic (Claude)</option>
                <option value="openai" ${settings.aiProvider === 'openai' ? 'selected' : ''}>OpenAI (GPT-4)</option>
                <option value="google" ${settings.aiProvider === 'google' ? 'selected' : ''}>Google (Gemini)</option>
            </select>
        </div>

        <div class="form-group">
            <label class="form-label">AI Model</label>
            <input type="text" class="form-input" id="settingAiModel" value="${settings.aiModel}" placeholder="claude-3-5-sonnet-20241022">
        </div>

        <div class="form-group">
            <label class="form-label">API Key</label>
            <input type="password" class="form-input" id="settingApiKey" value="${settings.apiKey}" placeholder="Enter your API key">
            <div class="form-help">Your API key is stored locally and never sent anywhere except to the AI provider.</div>
        </div>

        <div class="form-group">
            <label class="form-label">Currency</label>
            <select class="form-select" id="settingCurrency">
                <option value="USD" ${settings.currency === 'USD' ? 'selected' : ''}>USD ($)</option>
                <option value="EUR" ${settings.currency === 'EUR' ? 'selected' : ''}>EUR (€)</option>
                <option value="GBP" ${settings.currency === 'GBP' ? 'selected' : ''}>GBP (£)</option>
            </select>
        </div>

        <div class="form-group">
            <label class="form-label">Date Format</label>
            <select class="form-select" id="settingDateFormat">
                <option value="MM/DD/YYYY" ${settings.dateFormat === 'MM/DD/YYYY' ? 'selected' : ''}>MM/DD/YYYY</option>
                <option value="DD/MM/YYYY" ${settings.dateFormat === 'DD/MM/YYYY' ? 'selected' : ''}>DD/MM/YYYY</option>
                <option value="YYYY-MM-DD" ${settings.dateFormat === 'YYYY-MM-DD' ? 'selected' : ''}>YYYY-MM-DD</option>
            </select>
        </div>

        <div class="form-group">
            <label class="form-label">Default Weekly Training Hours</label>
            <input type="number" class="form-input" id="settingDefaultWeeklyHours" value="${settings.defaultWeeklyHours}" min="1" max="40">
        </div>

        <div class="form-group">
            <label class="form-label">Default Annual Budget</label>
            <input type="number" class="form-input" id="settingDefaultBudget" value="${settings.defaultBudget}" min="0">
        </div>

        <div class="form-group">
            <label class="form-checkbox">
                <input type="checkbox" id="settingAutoSave" ${settings.autoSaveEnabled ? 'checked' : ''}>
                <span>Enable auto-save</span>
            </label>
        </div>

        <div class="form-group">
            <label class="form-checkbox">
                <input type="checkbox" id="settingConfirmDelete" ${settings.confirmBeforeDelete ? 'checked' : ''}>
                <span>Confirm before deleting items</span>
            </label>
        </div>
    `;

    document.getElementById('settingsContent').innerHTML = html;
    document.getElementById('settingsModal').classList.add('active');
}

function closeSettings() {
    document.getElementById('settingsModal').classList.remove('active');
}

function saveSettings() {
    settings.aiProvider = document.getElementById('settingAiProvider').value;
    settings.aiModel = document.getElementById('settingAiModel').value;
    settings.apiKey = document.getElementById('settingApiKey').value;
    settings.currency = document.getElementById('settingCurrency').value;
    settings.dateFormat = document.getElementById('settingDateFormat').value;
    settings.defaultWeeklyHours = parseInt(document.getElementById('settingDefaultWeeklyHours').value);
    settings.defaultBudget = parseFloat(document.getElementById('settingDefaultBudget').value);
    settings.autoSaveEnabled = document.getElementById('settingAutoSave').checked;
    settings.confirmBeforeDelete = document.getElementById('settingConfirmDelete').checked;

    // Update currency symbol
    const currencySymbols = { 'USD': '$', 'EUR': '€', 'GBP': '£' };
    settings.currencySymbol = currencySymbols[settings.currency] || '$';

    closeSettings();
    triggerSave();
    renderAllViews();
}

function showHelp() {
    const html = `
        <h3>Welcome to Training Plan Manager</h3>
        <p>This application helps engineering managers create AI-assisted training plans for their technical team members.</p>

        <h4 style="margin-top: 20px;">Getting Started:</h4>
        <ol>
            <li><strong>Configure AI:</strong> Click Settings (⚙️) and enter your API key</li>
            <li><strong>Add Resources:</strong> Go to the Resources tab and add team members</li>
            <li><strong>Build Library:</strong> Add competencies and courses to your library</li>
            <li><strong>Create Plans:</strong> Use the Training Plans wizard to create AI-assisted training plans</li>
        </ol>

        <h4 style="margin-top: 20px;">Features:</h4>
        <ul>
            <li><strong>Dashboard:</strong> At-a-glance overview of your training program</li>
            <li><strong>Resources:</strong> Manage team members and track their competencies</li>
            <li><strong>Competencies:</strong> Build a reusable library of skills and competencies</li>
            <li><strong>Course Catalog:</strong> Track available training courses</li>
            <li><strong>Training Plans:</strong> Create comprehensive training plans with AI assistance</li>
            <li><strong>Calendars:</strong> Manage regional holidays and availability</li>
            <li><strong>Reports:</strong> Analyze budget, progress, and effectiveness</li>
        </ul>

        <h4 style="margin-top: 20px;">Data Management:</h4>
        <p>All data is stored locally in your browser. You can:</p>
        <ul>
            <li>Export to JSON for backup</li>
            <li>Import from JSON to restore data</li>
            <li>Load sample data to see examples</li>
        </ul>

        <div class="alert alert-info" style="margin-top: 20px;">
            <strong>Privacy Note:</strong> Your data never leaves your computer except when making AI API calls. Your API key is stored locally in your browser.
        </div>
    `;

    openModal('Help & Documentation', html);
}

// === DASHBOARD (TAB 1) ===
function renderDashboard() {
    const content = document.getElementById('dashboardContent');

    const metrics = calculateDashboardMetrics();

    const html = `
        <!-- Metrics Cards -->
        <div class="grid-3 mb-2">
            <div class="card metric-card">
                <div class="metric-label">Total Resources</div>
                <div class="metric-value">${metrics.totalResources}</div>
                <div class="metric-change">${metrics.locations} locations</div>
            </div>

            <div class="card metric-card">
                <div class="metric-label">Budget Status</div>
                <div class="metric-value">${formatCurrency(metrics.totalBudgetSpent)} / ${formatCurrency(metrics.totalBudget)}</div>
                <div class="metric-change">${metrics.budgetUtilization}% utilized</div>
            </div>

            <div class="card metric-card">
                <div class="metric-label">Training Plans</div>
                <div class="metric-value">${metrics.activePlans}</div>
                <div class="metric-change">${metrics.completionRate}% completion rate</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="btn btn-primary" onclick="switchTab(2); showAddResourceForm()">+ Add Resource</button>
            <button class="btn btn-primary" onclick="switchTab(5); startNewPlan()">+ Create Training Plan</button>
            <button class="btn btn-secondary" onclick="switchTab(3)">Manage Competencies</button>
            <button class="btn btn-secondary" onclick="switchTab(4)">Browse Courses</button>
        </div>

        <!-- Resources Overview -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Resources at a Glance</h3>
                <button class="btn btn-sm btn-ghost" onclick="switchTab(2)">View All →</button>
            </div>
            <div class="card-body">
                ${renderResourcesTable()}
            </div>
        </div>

        <!-- Bottom Row: Deadlines & Activity -->
        <div class="grid-2 mt-2">
            <div class="card">
                <h3 class="card-title">Upcoming Deadlines</h3>
                <div class="card-body">
                    ${renderUpcomingDeadlines()}
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Recent Activity</h3>
                <div class="card-body">
                    ${renderRecentActivity()}
                </div>
            </div>
        </div>
    `;

    content.innerHTML = html;
}

function calculateDashboardMetrics() {
    const totalResources = resources.length;
    const locations = new Set(resources.map(r => r.location)).size;

    const totalBudget = resources.reduce((sum, r) => sum + (r.annualTrainingBudget || 0), 0);
    const totalBudgetSpent = resources.reduce((sum, r) => sum + (r.budgetSpent || 0), 0);
    const budgetUtilization = totalBudget > 0 ? Math.round((totalBudgetSpent / totalBudget) * 100) : 0;

    const activePlans = trainingPlans.filter(p => p.status === 'Active').length;

    let completedCourses = 0;
    let totalCourses = 0;
    resources.forEach(r => {
        if (r.assignedCourses) {
            totalCourses += r.assignedCourses.length;
            completedCourses += r.assignedCourses.filter(c => c.status === 'Completed').length;
        }
    });
    const completionRate = totalCourses > 0 ? Math.round((completedCourses / totalCourses) * 100) : 0;

    return {
        totalResources,
        locations,
        totalBudget,
        totalBudgetSpent,
        budgetUtilization,
        activePlans,
        completionRate
    };
}

function renderResourcesTable() {
    if (resources.length === 0) {
        return `<div class="empty-state">
            <div class="empty-state-title">No Resources Yet</div>
            <div class="empty-state-description">Add your first team member to get started.</div>
            <button class="btn btn-primary" onclick="switchTab(2); showAddResourceForm()">+ Add Resource</button>
        </div>`;
    }

    let html = `
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Title</th>
                        <th>Location</th>
                        <th>Budget</th>
                        <th>Courses</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
    `;

    resources.slice(0, 10).forEach(resource => {
        const budgetUsed = resource.budgetSpent || 0;
        const budgetTotal = resource.annualTrainingBudget || 0;
        const budgetPercent = budgetTotal > 0 ? Math.round((budgetUsed / budgetTotal) * 100) : 0;

        const assignedCourses = resource.assignedCourses || [];
        const completedCourses = assignedCourses.filter(c => c.status === 'Completed').length;
        const courseStatus = `${completedCourses} / ${assignedCourses.length}`;

        let status = 'On Track';
        if (budgetPercent > 90) status = 'At Risk';
        if (completedCourses < assignedCourses.length * 0.5) status = 'Behind';

        html += `
            <tr onclick="viewResourceDetail(${resource.id})" style="cursor: pointer;">
                <td><strong>${escapeHtml(resource.name)}</strong></td>
                <td>${escapeHtml(resource.jobTitle || '')}</td>
                <td>${escapeHtml(resource.location || '')}</td>
                <td>${formatCurrency(budgetUsed)} / ${formatCurrency(budgetTotal)}</td>
                <td>${courseStatus}</td>
                <td>${getStatusDot(status)} ${status}</td>
            </tr>
        `;
    });

    html += '</tbody></table></div>';

    if (resources.length > 10) {
        html += `<div style="text-align: center; margin-top: 12px; color: var(--text-muted);">
            Showing 10 of ${resources.length} resources. <a href="#" onclick="switchTab(2); return false;">View all →</a>
        </div>`;
    }

    return html;
}

function renderUpcomingDeadlines() {
    const deadlines = [];

    resources.forEach(resource => {
        if (resource.assignedCourses) {
            resource.assignedCourses.forEach(course => {
                if (course.scheduledEndDate && course.status !== 'Completed') {
                    deadlines.push({
                        resourceName: resource.name,
                        date: course.scheduledEndDate,
                        description: `${resource.name}: Complete course`
                    });
                }
            });
        }

        if (resource.desiredCompetencies) {
            resource.desiredCompetencies.forEach(comp => {
                if (comp.targetDate) {
                    deadlines.push({
                        resourceName: resource.name,
                        date: comp.targetDate,
                        description: `${resource.name}: Achieve competency target`
                    });
                }
            });
        }
    });

    deadlines.sort((a, b) => new Date(a.date) - new Date(b.date));

    if (deadlines.length === 0) {
        return '<div class="text-muted">No upcoming deadlines</div>';
    }

    let html = '<ul class="list-group" style="border: none;">';
    deadlines.slice(0, 5).forEach(deadline => {
        html += `<li class="list-item">
            <div>
                <div class="list-item-title">${deadline.description}</div>
                <div class="list-item-subtitle">${formatDate(deadline.date)}</div>
            </div>
        </li>`;
    });
    html += '</ul>';

    return html;
}

function renderRecentActivity() {
    return `<ul class="list-group" style="border: none;">
        <li class="list-item">
            <div class="list-item-title">Sample data loaded</div>
            <div class="list-item-subtitle">Just now</div>
        </li>
        <li class="list-item">
            <div class="list-item-title">Application initialized</div>
            <div class="list-item-subtitle">Just now</div>
        </li>
    </ul>`;
}

// === RESOURCES (TAB 2) ===
function renderResources() {
    const content = document.getElementById('resourcesContent');

    const html = `
        <div class="card-header mb-2">
            <h2 class="card-title">Team Resources</h2>
            <button class="btn btn-primary" onclick="showAddResourceForm()">+ Add Resource</button>
        </div>

        <div class="search-filter-bar">
            <input type="text" class="form-input search-input" placeholder="Search resources..." id="resourceSearch" oninput="filterResources()">
            <select class="form-select" id="resourceFilterLocation" onchange="filterResources()">
                <option value="">All Locations</option>
                ${[...new Set(resources.map(r => r.location))].map(loc => `<option value="${loc}">${loc}</option>`).join('')}
            </select>
        </div>

        <div id="resourcesList">
            ${renderResourcesList()}
        </div>
    `;

    content.innerHTML = html;
}

function renderResourcesList() {
    if (resources.length === 0) {
        return `<div class="empty-state">
            <div class="empty-state-icon">👥</div>
            <div class="empty-state-title">No Resources Yet</div>
            <div class="empty-state-description">Add your first team member to start creating training plans.</div>
            <button class="btn btn-primary" onclick="showAddResourceForm()">+ Add Resource</button>
        </div>`;
    }

    let html = '<div class="grid-auto">';

    resources.forEach(resource => {
        const budgetUsed = resource.budgetSpent || 0;
        const budgetTotal = resource.annualTrainingBudget || 0;
        const budgetPercent = budgetTotal > 0 ? Math.round((budgetUsed / budgetTotal) * 100) : 0;

        const currentCompetencies = resource.currentCompetencies || [];
        const assignedCourses = resource.assignedCourses || [];

        html += `
            <div class="card" onclick="viewResourceDetail(${resource.id})" style="cursor: pointer;">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">${escapeHtml(resource.name)}</h3>
                        <div class="card-subtitle">${escapeHtml(resource.jobTitle || 'No title')}</div>
                    </div>
                </div>
                <div class="card-body">
                    <div style="margin-bottom: 12px;">
                        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Location</div>
                        <div><strong>${escapeHtml(resource.location || 'Not specified')}</strong></div>
                    </div>

                    <div style="margin-bottom: 12px;">
                        <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Budget</div>
                        <div class="progress-labeled">
                            <div class="progress-bar" style="flex: 1;">
                                <div class="progress-fill" style="width: ${budgetPercent}%"></div>
                            </div>
                            <div class="progress-label">${budgetPercent}%</div>
                        </div>
                        <div style="font-size: 12px; margin-top: 4px;">${formatCurrency(budgetUsed)} / ${formatCurrency(budgetTotal)}</div>
                    </div>

                    <div style="display: flex; gap: 20px; font-size: 13px;">
                        <div>
                            <div style="color: var(--text-muted);">Competencies</div>
                            <div><strong>${currentCompetencies.length}</strong></div>
                        </div>
                        <div>
                            <div style="color: var(--text-muted);">Courses</div>
                            <div><strong>${assignedCourses.length}</strong></div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });

    html += '</div>';
    return html;
}

function filterResources() {
    const search = document.getElementById('resourceSearch').value.toLowerCase();
    const location = document.getElementById('resourceFilterLocation').value;

    let filtered = resources;

    if (search) {
        filtered = filtered.filter(r =>
            r.name.toLowerCase().includes(search) ||
            (r.jobTitle && r.jobTitle.toLowerCase().includes(search))
        );
    }

    if (location) {
        filtered = filtered.filter(r => r.location === location);
    }

    // Re-render with filtered list
    // For now, just re-render all
    renderResources();
}

function showAddResourceForm() {
    const html = `
        <div class="form-group">
            <label class="form-label form-label-required">Name</label>
            <input type="text" class="form-input" id="newResourceName" placeholder="John Smith">
        </div>

        <div class="form-group">
            <label class="form-label">Job Title</label>
            <input type="text" class="form-input" id="newResourceTitle" placeholder="Senior Developer">
        </div>

        <div class="form-group">
            <label class="form-label">Department</label>
            <input type="text" class="form-input" id="newResourceDepartment" placeholder="Engineering">
        </div>

        <div class="form-group">
            <label class="form-label">Location</label>
            <input type="text" class="form-input" id="newResourceLocation" placeholder="New York, USA">
        </div>

        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="newResourceEmail" placeholder="john@company.com">
        </div>

        <div class="form-group">
            <label class="form-label">Annual Training Budget</label>
            <input type="number" class="form-input" id="newResourceBudget" value="${settings.defaultBudget}" min="0">
        </div>

        <div class="form-group">
            <label class="form-label">Weekly Training Hours</label>
            <input type="number" class="form-input" id="newResourceHours" value="${settings.defaultWeeklyHours}" min="1" max="40">
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveNewResource()">Add Resource</button>
    `;

    openModal('Add New Resource', html, footer);
}

function saveNewResource() {
    const name = document.getElementById('newResourceName').value.trim();
    if (!name) {
        alert('Please enter a name');
        return;
    }

    const newResource = {
        id: nextResourceId++,
        name: name,
        email: document.getElementById('newResourceEmail').value.trim(),
        jobTitle: document.getElementById('newResourceTitle').value.trim(),
        department: document.getElementById('newResourceDepartment').value.trim(),
        location: document.getElementById('newResourceLocation').value.trim(),
        hireDate: new Date().toISOString().split('T')[0],
        annualTrainingBudget: parseFloat(document.getElementById('newResourceBudget').value) || 0,
        budgetSpent: 0,
        budgetYear: new Date().getFullYear(),
        currentCompetencies: [],
        desiredCompetencies: [],
        weeklyTrainingHours: parseInt(document.getElementById('newResourceHours').value) || 5,
        preferredTrainingDays: [],
        learningPace: settings.defaultLearningPace,
        formatPreference: 'Online',
        regionalCalendarId: settings.defaultRegionalCalendar,
        personalTimeOff: [],
        blackoutPeriods: [],
        assignedCourses: [],
        notes: '',
        tags: [],
        createdDate: new Date().toISOString(),
        lastModified: new Date().toISOString(),
        createdBy: 'Manager'
    };

    resources.push(newResource);
    closeModal();
    triggerSave();
    renderResources();
    renderDashboard();
}

function viewResourceDetail(resourceId) {
    const resource = resources.find(r => r.id === resourceId);
    if (!resource) return;

    // For now, just show basic info
    const html = `
        <div>
            <h3>${resource.name}</h3>
            <p><strong>Title:</strong> ${resource.jobTitle || 'N/A'}</p>
            <p><strong>Location:</strong> ${resource.location || 'N/A'}</p>
            <p><strong>Budget:</strong> ${formatCurrency(resource.budgetSpent)} / ${formatCurrency(resource.annualTrainingBudget)}</p>
            <p><strong>Competencies:</strong> ${resource.currentCompetencies.length}</p>
            <p><strong>Assigned Courses:</strong> ${resource.assignedCourses.length}</p>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Close</button>
        <button class="btn btn-secondary" onclick="editResource(${resourceId})">Edit</button>
        <button class="btn btn-error" onclick="deleteResource(${resourceId})">Delete</button>
    `;

    openModal(`Resource: ${resource.name}`, html, footer);
}

function deleteResource(resourceId) {
    if (settings.confirmBeforeDelete) {
        if (!confirm('Are you sure you want to delete this resource? This action cannot be undone.')) {
            return;
        }
    }

    const index = resources.findIndex(r => r.id === resourceId);
    if (index > -1) {
        resources.splice(index, 1);
        closeModal();
        triggerSave();
        renderResources();
        renderDashboard();
    }
}

function editResource(resourceId) {
    const resource = resources.find(r => r.id === resourceId);
    if (!resource) return;

    const html = `
        <div class="form-group">
            <label class="form-label form-label-required">Name</label>
            <input type="text" class="form-input" id="editResourceName" value="${escapeHtml(resource.name)}" placeholder="John Smith">
        </div>

        <div class="form-group">
            <label class="form-label">Job Title</label>
            <input type="text" class="form-input" id="editResourceTitle" value="${escapeHtml(resource.jobTitle || '')}" placeholder="Senior Developer">
        </div>

        <div class="form-group">
            <label class="form-label">Department</label>
            <input type="text" class="form-input" id="editResourceDepartment" value="${escapeHtml(resource.department || '')}" placeholder="Engineering">
        </div>

        <div class="form-group">
            <label class="form-label">Location</label>
            <input type="text" class="form-input" id="editResourceLocation" value="${escapeHtml(resource.location || '')}" placeholder="New York, USA">
        </div>

        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="editResourceEmail" value="${escapeHtml(resource.email || '')}" placeholder="john@company.com">
        </div>

        <div class="form-group">
            <label class="form-label">Annual Training Budget</label>
            <input type="number" class="form-input" id="editResourceBudget" value="${resource.annualTrainingBudget || 0}" min="0">
        </div>

        <div class="form-group">
            <label class="form-label">Budget Spent</label>
            <input type="number" class="form-input" id="editResourceBudgetSpent" value="${resource.budgetSpent || 0}" min="0">
            <div class="form-help">Track actual spending on training for this resource</div>
        </div>

        <div class="form-group">
            <label class="form-label">Weekly Training Hours</label>
            <input type="number" class="form-input" id="editResourceHours" value="${resource.weeklyTrainingHours || 5}" min="1" max="40">
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveResourceEdits(${resourceId})">Save Changes</button>
    `;

    openModal('Edit Resource: ' + resource.name, html, footer);
}

function saveResourceEdits(resourceId) {
    const name = document.getElementById('editResourceName').value.trim();
    if (!name) {
        alert('Please enter a name');
        return;
    }

    const resource = resources.find(r => r.id === resourceId);
    if (!resource) return;

    // Update resource fields
    resource.name = name;
    resource.email = document.getElementById('editResourceEmail').value.trim();
    resource.jobTitle = document.getElementById('editResourceTitle').value.trim();
    resource.department = document.getElementById('editResourceDepartment').value.trim();
    resource.location = document.getElementById('editResourceLocation').value.trim();
    resource.annualTrainingBudget = parseFloat(document.getElementById('editResourceBudget').value) || 0;
    resource.budgetSpent = parseFloat(document.getElementById('editResourceBudgetSpent').value) || 0;
    resource.weeklyTrainingHours = parseInt(document.getElementById('editResourceHours').value) || 5;
    resource.lastModified = new Date().toISOString();

    closeModal();
    triggerSave();
    renderResources();
    renderDashboard();
}

// === COMPETENCY LIBRARY (TAB 3) ===
function renderCompetencies() {
    const content = document.getElementById('competenciesContent');

    const html = `
        <div class="card-header mb-2">
            <h2 class="card-title">Competency Library</h2>
            <div style="display: flex; gap: 8px;">
                <button class="btn btn-ghost" onclick="showManageCategories()">Manage Categories</button>
                <button class="btn btn-primary" onclick="showAddCompetencyForm()">+ Add Competency</button>
            </div>
        </div>

        <div class="search-filter-bar">
            <input type="text" class="form-input search-input" placeholder="Search competencies..." id="compSearch" oninput="renderCompetencies()">
            <select class="form-select" id="compFilterCategory" onchange="renderCompetencies()">
                <option value="">All Categories</option>
                ${[...new Set(competencyLibrary.map(c => c.category))].map(cat => `<option value="${cat}">${cat}</option>`).join('')}
            </select>
        </div>

        <div id="competenciesList">
            ${renderCompetenciesList()}
        </div>
    `;

    content.innerHTML = html;
}

function renderCompetenciesList() {
    if (competencyLibrary.length === 0) {
        return `<div class="empty-state">
            <div class="empty-state-icon">🎯</div>
            <div class="empty-state-title">No Competencies Yet</div>
            <div class="empty-state-description">Build your competency library to track skills and expertise.</div>
            <button class="btn btn-primary" onclick="showAddCompetencyForm()">+ Add Competency</button>
        </div>`;
    }

    let html = '<div class="table-container"><table><thead><tr>';
    html += '<th>Competency</th><th>Category</th><th>Subcategory</th><th>Used By</th><th>Actions</th>';
    html += '</tr></thead><tbody>';

    competencyLibrary.forEach(comp => {
        const useCount = getCompetencyUsage(comp.id);

        html += `
            <tr>
                <td><strong>${escapeHtml(comp.name)}</strong></td>
                <td>${escapeHtml(comp.category || 'Uncategorized')}</td>
                <td>${escapeHtml(comp.subcategory || '-')}</td>
                <td>${useCount} resources</td>
                <td class="table-actions">
                    <button class="btn btn-sm btn-ghost" onclick="viewCompetencyDetail(${comp.id})">View</button>
                    <button class="btn btn-sm btn-ghost" onclick="deleteCompetency(${comp.id})">Delete</button>
                </td>
            </tr>
        `;
    });

    html += '</tbody></table></div>';
    return html;
}

function getCompetencyUsage(competencyId) {
    let count = 0;
    resources.forEach(r => {
        if (r.currentCompetencies && r.currentCompetencies.some(c => c.competencyId === competencyId)) {
            count++;
        }
        if (r.desiredCompetencies && r.desiredCompetencies.some(c => c.competencyId === competencyId)) {
            count++;
        }
    });
    return count;
}

// Helper function to extract unique categories from competencyLibrary
function getUniqueCategories() {
    const categories = new Set();
    competencyLibrary.forEach(comp => {
        if (comp.category && comp.category.trim() !== '') {
            categories.add(comp.category.trim());
        }
    });
    return Array.from(categories).sort();
}

// Helper function to extract subcategories for a given category
function getSubcategoriesForCategory(category) {
    const subcategories = new Set();
    competencyLibrary.forEach(comp => {
        if (comp.category === category && comp.subcategory && comp.subcategory.trim() !== '') {
            subcategories.add(comp.subcategory.trim());
        }
    });
    return Array.from(subcategories).sort();
}

// Handle category change to update subcategory dropdown
function handleCategoryChange() {
    const categorySelect = document.getElementById('newCompCategory');
    const subcategorySelect = document.getElementById('newCompSubcategory');
    const customCategoryInput = document.getElementById('customCategoryInput');
    const customSubcategoryInput = document.getElementById('customSubcategoryInput');

    const selectedCategory = categorySelect.value;

    // Show/hide custom category input
    if (selectedCategory === '__custom__') {
        customCategoryInput.style.display = 'block';
        subcategorySelect.innerHTML = '<option value="">Select subcategory...</option><option value="__custom__">+ Add New Subcategory</option>';
        subcategorySelect.disabled = false;
    } else {
        customCategoryInput.style.display = 'none';

        // Populate subcategories for selected category
        const subcategories = getSubcategoriesForCategory(selectedCategory);
        subcategorySelect.innerHTML = '<option value="">Select subcategory...</option>';
        subcategories.forEach(subcat => {
            subcategorySelect.innerHTML += `<option value="${escapeHtml(subcat)}">${escapeHtml(subcat)}</option>`;
        });
        subcategorySelect.innerHTML += '<option value="__custom__">+ Add New Subcategory</option>';
        subcategorySelect.disabled = false;
    }

    // Reset custom subcategory input
    customSubcategoryInput.style.display = 'none';
}

// Handle subcategory change to show/hide custom input
function handleSubcategoryChange() {
    const subcategorySelect = document.getElementById('newCompSubcategory');
    const customSubcategoryInput = document.getElementById('customSubcategoryInput');

    if (subcategorySelect.value === '__custom__') {
        customSubcategoryInput.style.display = 'block';
    } else {
        customSubcategoryInput.style.display = 'none';
    }
}

function showAddCompetencyForm() {
    const categories = getUniqueCategories();

    let categoryOptions = '<option value="">Select category...</option>';
    categories.forEach(cat => {
        categoryOptions += `<option value="${escapeHtml(cat)}">${escapeHtml(cat)}</option>`;
    });
    categoryOptions += '<option value="__custom__">+ Add New Category</option>';

    const html = `
        <div class="form-group">
            <label class="form-label form-label-required">Name</label>
            <input type="text" class="form-input" id="newCompName" placeholder="Python Programming">
        </div>

        <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-input" id="newCompCategory" onchange="handleCategoryChange()">
                ${categoryOptions}
            </select>
            <input type="text" class="form-input" id="customCategoryInput" placeholder="Enter new category..." style="display: none; margin-top: 8px;">
        </div>

        <div class="form-group">
            <label class="form-label">Subcategory</label>
            <select class="form-input" id="newCompSubcategory" onchange="handleSubcategoryChange()" disabled>
                <option value="">Select category first...</option>
            </select>
            <input type="text" class="form-input" id="customSubcategoryInput" placeholder="Enter new subcategory..." style="display: none; margin-top: 8px;">
        </div>

        <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="newCompDescription" placeholder="What this competency encompasses..."></textarea>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveNewCompetency()">Add Competency</button>
    `;

    openModal('Add New Competency', html, footer);
}

function saveNewCompetency() {
    const name = document.getElementById('newCompName').value.trim();
    if (!name) {
        alert('Please enter a name');
        return;
    }

    // Determine category value (dropdown or custom input)
    let category = document.getElementById('newCompCategory').value.trim();
    if (category === '__custom__') {
        category = document.getElementById('customCategoryInput').value.trim();
        if (!category) {
            alert('Please enter a category name or select an existing one');
            return;
        }
    } else if (!category) {
        category = 'Uncategorized';
    }

    // Determine subcategory value (dropdown or custom input)
    let subcategory = document.getElementById('newCompSubcategory').value.trim();
    if (subcategory === '__custom__') {
        subcategory = document.getElementById('customSubcategoryInput').value.trim();
        if (!subcategory) {
            alert('Please enter a subcategory name');
            return;
        }
    }
    // Subcategory is optional, so empty string is acceptable

    const newComp = {
        id: nextCompetencyId++,
        name: name,
        category: category,
        subcategory: subcategory,
        description: document.getElementById('newCompDescription').value.trim(),
        levelDefinitions: {
            1: { name: 'Awareness', description: 'Basic understanding. Can follow documentation with guidance.' },
            2: { name: 'Beginner', description: 'Can perform basic tasks independently. Needs help with complex scenarios.' },
            3: { name: 'Intermediate', description: 'Handles most tasks independently. Good working knowledge.' },
            4: { name: 'Advanced', description: 'Expert-level skills. Handles complex scenarios confidently.' },
            5: { name: 'Expert', description: 'Industry-recognized expertise. Thought leader. Drives innovation.' }
        },
        frameworkMappings: {},
        relatedCompetencies: [],
        prerequisites: [],
        useCount: 0,
        lastUsed: new Date().toISOString(),
        createdDate: new Date().toISOString(),
        lastModified: new Date().toISOString(),
        createdBy: 'Manager',
        isActive: true
    };

    competencyLibrary.push(newComp);
    closeModal();
    triggerSave();
    renderCompetencies();
}

function viewCompetencyDetail(competencyId) {
    const comp = competencyLibrary.find(c => c.id === competencyId);
    if (!comp) return;

    const usage = getCompetencyUsage(comp.id);

    const html = `
        <div>
            <h3>${comp.name}</h3>
            <p><strong>Category:</strong> ${comp.category}</p>
            <p><strong>Subcategory:</strong> ${comp.subcategory || 'N/A'}</p>
            <p><strong>Description:</strong> ${comp.description || 'No description'}</p>
            <p><strong>Used by:</strong> ${usage} resources</p>

            <h4 style="margin-top: 20px;">Proficiency Levels</h4>
            <div style="margin-left: 20px;">
                ${Object.keys(comp.levelDefinitions).map(level => `
                    <div style="margin: 10px 0;">
                        <strong>${level}. ${comp.levelDefinitions[level].name}:</strong>
                        ${comp.levelDefinitions[level].description}
                    </div>
                `).join('')}
            </div>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Close</button>
        <button class="btn btn-error" onclick="deleteCompetency(${competencyId})">Delete</button>
    `;

    openModal(`Competency: ${comp.name}`, html, footer);
}

function deleteCompetency(competencyId) {
    const usage = getCompetencyUsage(competencyId);
    if (usage > 0 && settings.confirmBeforeDelete) {
        if (!confirm(`This competency is used by ${usage} resources. Deleting it will remove it from all resources. Continue?`)) {
            return;
        }
    }

    // Remove from all resources
    resources.forEach(r => {
        if (r.currentCompetencies) {
            r.currentCompetencies = r.currentCompetencies.filter(c => c.competencyId !== competencyId);
        }
        if (r.desiredCompetencies) {
            r.desiredCompetencies = r.desiredCompetencies.filter(c => c.competencyId !== competencyId);
        }
    });

    // Remove from library
    const index = competencyLibrary.findIndex(c => c.id === competencyId);
    if (index > -1) {
        competencyLibrary.splice(index, 1);
    }

    closeModal();
    triggerSave();
    renderCompetencies();
}

// === CATEGORY MANAGEMENT ===
function showManageCategories() {
    const categories = getUniqueCategories();
    const categoriesWithSubcats = {};

    // Build category hierarchy
    categories.forEach(cat => {
        categoriesWithSubcats[cat] = {
            subcategories: getSubcategoriesForCategory(cat),
            competencyCount: competencyLibrary.filter(c => c.category === cat).length
        };
    });

    let html = `
        <div style="margin-bottom: 20px;">
            <h3>Category Management</h3>
            <p style="color: #666; margin-bottom: 20px;">Manage categories and subcategories for your competency library. Categories help organize competencies, and subcategories provide additional classification.</p>

            <div style="display: flex; gap: 12px; margin-bottom: 24px;">
                <button class="btn btn-primary" onclick="showAddCategoryForm()">+ Add Category</button>
                <button class="btn btn-primary" onclick="showAddSubcategoryForm()">+ Add Subcategory</button>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Subcategories</th>
                        <th>Competencies</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>`;

    if (categories.length === 0) {
        html += `
            <tr>
                <td colspan="4" style="text-align: center; padding: 40px; color: #666;">
                    <div>No categories yet. Categories are automatically created when you add competencies,</div>
                    <div>or you can create them manually using the buttons above.</div>
                </td>
            </tr>`;
    } else {
        categories.forEach(cat => {
            const data = categoriesWithSubcats[cat];
            const subcatsList = data.subcategories.length > 0
                ? data.subcategories.map(s => `<span class="badge badge-secondary">${escapeHtml(s)}</span>`).join(' ')
                : '<span style="color: #999;">None</span>';

            html += `
                <tr>
                    <td><strong>${escapeHtml(cat)}</strong></td>
                    <td>${subcatsList}</td>
                    <td>${data.competencyCount} competenc${data.competencyCount === 1 ? 'y' : 'ies'}</td>
                    <td class="table-actions">
                        <button class="btn btn-sm btn-ghost" onclick="viewCategoryDetails('${escapeHtml(cat).replace(/'/g, "\\'")}')">View Details</button>
                        <button class="btn btn-sm btn-ghost" onclick="editCategory('${escapeHtml(cat).replace(/'/g, "\\'")}')">Edit</button>
                        <button class="btn btn-sm btn-ghost" onclick="deleteCategory('${escapeHtml(cat).replace(/'/g, "\\'")}')">Delete</button>
                    </td>
                </tr>`;
        });
    }

    html += `
                </tbody>
            </table>
        </div>

        <div style="margin-top: 24px; padding: 16px; background: #f5f5f5; border-radius: 6px;">
            <h4 style="margin-top: 0;">Category Relationships</h4>
            <ul style="margin: 8px 0; padding-left: 20px; color: #666;">
                <li>Each competency must belong to one category</li>
                <li>Subcategories are optional and provide additional classification within a category</li>
                <li>One subcategory can only belong to one category</li>
                <li>Deleting a category will remove it from all associated competencies</li>
                <li>Deleting a subcategory will remove it from all associated competencies</li>
            </ul>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Close</button>
    `;

    openModal('Manage Categories & Subcategories', html, footer, 'modal-large');
}

function showAddCategoryForm() {
    const html = `
        <div class="form-group">
            <label class="form-label form-label-required">Category Name</label>
            <input type="text" class="form-input" id="newCategoryName" placeholder="e.g., Programming Languages, Cloud Platforms, Security">
            <div class="form-help">Choose a clear, descriptive name for this category</div>
        </div>

        <div class="form-group">
            <label class="form-label">Description (Optional)</label>
            <textarea class="form-textarea" id="newCategoryDescription" placeholder="What types of competencies belong in this category?"></textarea>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveNewCategory()">Add Category</button>
    `;

    openModal('Add New Category', html, footer);
}

function saveNewCategory() {
    const name = document.getElementById('newCategoryName').value.trim();

    if (!name) {
        alert('Please enter a category name');
        return;
    }

    // Check if category already exists
    const existingCategories = getUniqueCategories();
    if (existingCategories.includes(name)) {
        alert('This category already exists');
        return;
    }

    // Category will be available immediately for use
    // It doesn't need to be stored separately - it exists through competencies
    // But we can show a success message
    closeModal();
    alert(`Category "${name}" created. It's now available when adding competencies.`);
    showManageCategories();
}

function showAddSubcategoryForm() {
    const categories = getUniqueCategories();

    if (categories.length === 0) {
        alert('Please create at least one category first');
        return;
    }

    let categoryOptions = '<option value="">Select parent category...</option>';
    categories.forEach(cat => {
        categoryOptions += `<option value="${escapeHtml(cat)}">${escapeHtml(cat)}</option>`;
    });

    const html = `
        <div class="form-group">
            <label class="form-label form-label-required">Parent Category</label>
            <select class="form-input" id="newSubcategoryParent">
                ${categoryOptions}
            </select>
            <div class="form-help">Select the category this subcategory belongs to</div>
        </div>

        <div class="form-group">
            <label class="form-label form-label-required">Subcategory Name</label>
            <input type="text" class="form-input" id="newSubcategoryName" placeholder="e.g., Backend Development, Container Orchestration">
            <div class="form-help">Choose a clear, descriptive name for this subcategory</div>
        </div>

        <div class="form-group">
            <label class="form-label">Description (Optional)</label>
            <textarea class="form-textarea" id="newSubcategoryDescription" placeholder="What types of competencies belong in this subcategory?"></textarea>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveNewSubcategory()">Add Subcategory</button>
    `;

    openModal('Add New Subcategory', html, footer);
}

function saveNewSubcategory() {
    const parentCategory = document.getElementById('newSubcategoryParent').value.trim();
    const name = document.getElementById('newSubcategoryName').value.trim();

    if (!parentCategory) {
        alert('Please select a parent category');
        return;
    }

    if (!name) {
        alert('Please enter a subcategory name');
        return;
    }

    // Check if subcategory already exists in this category
    const existingSubcats = getSubcategoriesForCategory(parentCategory);
    if (existingSubcats.includes(name)) {
        alert(`Subcategory "${name}" already exists in category "${parentCategory}"`);
        return;
    }

    closeModal();
    alert(`Subcategory "${name}" created under "${parentCategory}". It's now available when adding competencies.`);
    showManageCategories();
}

function editCategory(oldCategoryName) {
    const competenciesInCategory = competencyLibrary.filter(c => c.category === oldCategoryName);

    const html = `
        <div class="form-group">
            <label class="form-label form-label-required">Category Name</label>
            <input type="text" class="form-input" id="editCategoryName" value="${escapeHtml(oldCategoryName)}">
        </div>

        <div style="padding: 12px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin-top: 16px;">
            <strong>Note:</strong> Renaming this category will update ${competenciesInCategory.length} competenc${competenciesInCategory.length === 1 ? 'y' : 'ies'}.
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveCategoryEdit('${escapeHtml(oldCategoryName).replace(/'/g, "\\'")}')">Save Changes</button>
    `;

    openModal('Edit Category', html, footer);
}

function saveCategoryEdit(oldCategoryName) {
    const newCategoryName = document.getElementById('editCategoryName').value.trim();

    if (!newCategoryName) {
        alert('Please enter a category name');
        return;
    }

    if (newCategoryName === oldCategoryName) {
        closeModal();
        return;
    }

    // Check if new name already exists
    const existingCategories = getUniqueCategories();
    if (existingCategories.includes(newCategoryName)) {
        alert('A category with this name already exists');
        return;
    }

    // Update all competencies with this category
    competencyLibrary.forEach(comp => {
        if (comp.category === oldCategoryName) {
            comp.category = newCategoryName;
            comp.lastModified = new Date().toISOString();
        }
    });

    closeModal();
    triggerSave();
    renderCompetencies();
    showManageCategories();
}

function deleteCategory(categoryName) {
    const competenciesInCategory = competencyLibrary.filter(c => c.category === categoryName);

    if (competenciesInCategory.length > 0 && settings.confirmBeforeDelete) {
        if (!confirm(`This category is used by ${competenciesInCategory.length} competenc${competenciesInCategory.length === 1 ? 'y' : 'ies'}. Deleting it will set those competencies to "Uncategorized". Continue?`)) {
            return;
        }
    }

    // Set all competencies in this category to "Uncategorized"
    competencyLibrary.forEach(comp => {
        if (comp.category === categoryName) {
            comp.category = 'Uncategorized';
            comp.lastModified = new Date().toISOString();
        }
    });

    closeModal();
    triggerSave();
    renderCompetencies();
    showManageCategories();
}

function editSubcategory(categoryName, oldSubcategoryName) {
    const competenciesWithSubcat = competencyLibrary.filter(c => c.category === categoryName && c.subcategory === oldSubcategoryName);

    const html = `
        <div class="form-group">
            <label class="form-label">Parent Category</label>
            <input type="text" class="form-input" value="${escapeHtml(categoryName)}" disabled>
            <div class="form-help">The parent category cannot be changed. To move subcategories, delete and recreate.</div>
        </div>

        <div class="form-group">
            <label class="form-label form-label-required">Subcategory Name</label>
            <input type="text" class="form-input" id="editSubcategoryName" value="${escapeHtml(oldSubcategoryName)}">
        </div>

        <div style="padding: 12px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin-top: 16px;">
            <strong>Note:</strong> Renaming this subcategory will update ${competenciesWithSubcat.length} competenc${competenciesWithSubcat.length === 1 ? 'y' : 'ies'}.
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveSubcategoryEdit('${escapeHtml(categoryName).replace(/'/g, "\\'")}', '${escapeHtml(oldSubcategoryName).replace(/'/g, "\\'")}')">Save Changes</button>
    `;

    openModal('Edit Subcategory', html, footer);
}

function saveSubcategoryEdit(categoryName, oldSubcategoryName) {
    const newSubcategoryName = document.getElementById('editSubcategoryName').value.trim();

    if (!newSubcategoryName) {
        alert('Please enter a subcategory name');
        return;
    }

    if (newSubcategoryName === oldSubcategoryName) {
        closeModal();
        return;
    }

    // Check if new name already exists in this category
    const existingSubcats = getSubcategoriesForCategory(categoryName);
    if (existingSubcats.includes(newSubcategoryName)) {
        alert('A subcategory with this name already exists in this category');
        return;
    }

    // Update all competencies with this subcategory
    competencyLibrary.forEach(comp => {
        if (comp.category === categoryName && comp.subcategory === oldSubcategoryName) {
            comp.subcategory = newSubcategoryName;
            comp.lastModified = new Date().toISOString();
        }
    });

    closeModal();
    triggerSave();
    renderCompetencies();
    showManageCategories();
}

function deleteSubcategory(categoryName, subcategoryName) {
    const competenciesWithSubcat = competencyLibrary.filter(c => c.category === categoryName && c.subcategory === subcategoryName);

    if (competenciesWithSubcat.length > 0 && settings.confirmBeforeDelete) {
        if (!confirm(`This subcategory is used by ${competenciesWithSubcat.length} competenc${competenciesWithSubcat.length === 1 ? 'y' : 'ies'}. Deleting it will remove the subcategory from those competencies. Continue?`)) {
            return;
        }
    }

    // Remove subcategory from all competencies
    competencyLibrary.forEach(comp => {
        if (comp.category === categoryName && comp.subcategory === subcategoryName) {
            comp.subcategory = '';
            comp.lastModified = new Date().toISOString();
        }
    });

    closeModal();
    triggerSave();
    renderCompetencies();
    showManageCategories();
}

function viewCategoryDetails(categoryName) {
    const subcategories = getSubcategoriesForCategory(categoryName);
    const competenciesInCategory = competencyLibrary.filter(c => c.category === categoryName);

    let html = `
        <div style="margin-bottom: 24px;">
            <h3>${escapeHtml(categoryName)}</h3>
            <p style="color: #666;">${competenciesInCategory.length} competenc${competenciesInCategory.length === 1 ? 'y' : 'ies'} in this category</p>
        </div>

        <h4 style="margin-top: 24px; margin-bottom: 12px;">Subcategories (${subcategories.length})</h4>`;

    if (subcategories.length === 0) {
        html += `<p style="color: #999; padding: 20px; text-align: center; background: #f5f5f5; border-radius: 4px;">No subcategories yet</p>`;
    } else {
        html += '<div class="table-container"><table><thead><tr><th>Subcategory</th><th>Competencies</th><th>Actions</th></tr></thead><tbody>';

        subcategories.forEach(subcat => {
            const count = competencyLibrary.filter(c => c.category === categoryName && c.subcategory === subcat).length;
            html += `
                <tr>
                    <td><strong>${escapeHtml(subcat)}</strong></td>
                    <td>${count} competenc${count === 1 ? 'y' : 'ies'}</td>
                    <td class="table-actions">
                        <button class="btn btn-sm btn-ghost" onclick="editSubcategory('${escapeHtml(categoryName).replace(/'/g, "\\'")}', '${escapeHtml(subcat).replace(/'/g, "\\'")}')">Edit</button>
                        <button class="btn btn-sm btn-ghost" onclick="deleteSubcategory('${escapeHtml(categoryName).replace(/'/g, "\\'")}', '${escapeHtml(subcat).replace(/'/g, "\\'")}')">Delete</button>
                    </td>
                </tr>`;
        });

        html += '</tbody></table></div>';
    }

    html += `
        <h4 style="margin-top: 24px; margin-bottom: 12px;">Competencies in "${escapeHtml(categoryName)}"</h4>
        <div class="table-container"><table><thead><tr><th>Competency</th><th>Subcategory</th><th>Used By</th></tr></thead><tbody>`;

    if (competenciesInCategory.length === 0) {
        html += '<tr><td colspan="3" style="text-align: center; padding: 20px; color: #999;">No competencies in this category yet</td></tr>';
    } else {
        competenciesInCategory.forEach(comp => {
            const useCount = getCompetencyUsage(comp.id);
            html += `
                <tr>
                    <td><strong>${escapeHtml(comp.name)}</strong></td>
                    <td>${escapeHtml(comp.subcategory || '-')}</td>
                    <td>${useCount} resources</td>
                </tr>`;
        });
    }

    html += '</tbody></table></div>';

    const footer = `
        <button class="btn btn-ghost" onclick="showManageCategories()">Back to Categories</button>
        <button class="btn btn-ghost" onclick="closeModal()">Close</button>
    `;

    openModal(`Category: ${categoryName}`, html, footer, 'modal-large');
}

// === COURSE CATALOG (TAB 4) ===
function renderCourses() {
    const content = document.getElementById('coursesContent');

    const html = `
        <div class="card-header mb-2">
            <h2 class="card-title">Course Catalog</h2>
            <button class="btn btn-primary" onclick="showAddCourseForm()">+ Add Course</button>
        </div>

        <div class="search-filter-bar">
            <input type="text" class="form-input search-input" placeholder="Search courses..." id="courseSearch" oninput="renderCourses()">
            <select class="form-select" id="courseFilterProvider" onchange="renderCourses()">
                <option value="">All Providers</option>
                ${[...new Set(courseCatalog.map(c => c.provider))].map(prov => `<option value="${prov}">${prov}</option>`).join('')}
            </select>
            <select class="form-select" id="courseFilterFormat" onchange="renderCourses()">
                <option value="">All Formats</option>
                <option value="Online Self-Paced">Online Self-Paced</option>
                <option value="Online Live">Online Live</option>
                <option value="In-Person">In-Person</option>
                <option value="Hybrid">Hybrid</option>
            </select>
        </div>

        <div id="coursesList">
            ${renderCoursesList()}
        </div>
    `;

    content.innerHTML = html;
}

function renderCoursesList() {
    if (courseCatalog.length === 0) {
        return `<div class="empty-state">
            <div class="empty-state-icon">📚</div>
            <div class="empty-state-title">No Courses Yet</div>
            <div class="empty-state-description">Add courses to your catalog to build training plans.</div>
            <button class="btn btn-primary" onclick="showAddCourseForm()">+ Add Course</button>
        </div>`;
    }

    let html = '<div class="grid-auto">';

    courseCatalog.forEach(course => {
        const ratingStars = '⭐'.repeat(Math.round(course.rating || 0));

        html += `
            <div class="card">
                <div class="card-header">
                    <div style="flex: 1;">
                        <h3 class="card-title">${escapeHtml(course.title)}</h3>
                        <div class="card-subtitle">${escapeHtml(course.provider)}</div>
                    </div>
                    ${course.hasCertification ? '<span class="badge badge-success">Certification</span>' : ''}
                </div>
                <div class="card-body">
                    <div style="margin-bottom: 12px;">
                        <div>${ratingStars} ${course.rating ? course.rating.toFixed(1) : 'No rating'}</div>
                        ${course.ratingCount ? `<div style="font-size: 12px; color: var(--text-muted);">${course.ratingCount} reviews</div>` : ''}
                    </div>

                    <div style="display: flex; gap: 20px; margin-bottom: 12px; font-size: 13px;">
                        <div>
                            <div style="color: var(--text-muted);">Cost</div>
                            <div><strong>${formatCurrency(course.cost || 0)}</strong></div>
                        </div>
                        <div>
                            <div style="color: var(--text-muted);">Duration</div>
                            <div><strong>${course.duration?.totalHours || 0}h</strong></div>
                        </div>
                        <div>
                            <div style="color: var(--text-muted);">Level</div>
                            <div><strong>${course.skillLevel || 'All'}</strong></div>
                        </div>
                    </div>

                    <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">
                        ${course.format}
                    </div>

                    <div class="card-actions" style="border-top: 1px solid var(--border-light); margin-top: 12px;">
                        <button class="btn btn-sm btn-ghost" onclick="viewCourseDetail(${course.id})">View Details</button>
                        <button class="btn btn-sm btn-ghost" onclick="deleteCourse(${course.id})">Delete</button>
                    </div>
                </div>
            </div>
        `;
    });

    html += '</div>';
    return html;
}

function showAddCourseForm() {
    const html = `
        <div class="form-group">
            <label class="form-label form-label-required">Title</label>
            <input type="text" class="form-input" id="newCourseTitle" placeholder="AWS Certified Solutions Architect">
        </div>

        <div class="form-inline">
            <div class="form-group">
                <label class="form-label">Provider</label>
                <input type="text" class="form-input" id="newCourseProvider" placeholder="AWS Training">
            </div>

            <div class="form-group">
                <label class="form-label">Cost</label>
                <input type="number" class="form-input" id="newCourseCost" placeholder="300" min="0">
            </div>
        </div>

        <div class="form-inline">
            <div class="form-group">
                <label class="form-label">Format</label>
                <select class="form-select" id="newCourseFormat">
                    <option value="Online Self-Paced">Online Self-Paced</option>
                    <option value="Online Live">Online Live</option>
                    <option value="In-Person">In-Person</option>
                    <option value="Hybrid">Hybrid</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Duration (hours)</label>
                <input type="number" class="form-input" id="newCourseDuration" placeholder="40" min="1">
            </div>
        </div>

        <div class="form-inline">
            <div class="form-group">
                <label class="form-label">Skill Level</label>
                <select class="form-select" id="newCourseLevel">
                    <option value="Beginner">Beginner</option>
                    <option value="Intermediate">Intermediate</option>
                    <option value="Advanced">Advanced</option>
                    <option value="Expert">Expert</option>
                    <option value="All Levels">All Levels</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Rating (1-5)</label>
                <input type="number" class="form-input" id="newCourseRating" placeholder="4.5" min="1" max="5" step="0.1">
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">URL</label>
            <input type="url" class="form-input" id="newCourseUrl" placeholder="https://...">
        </div>

        <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="newCourseDescription" placeholder="Course overview..."></textarea>
        </div>

        <div class="form-group">
            <label class="form-checkbox">
                <input type="checkbox" id="newCourseCert">
                <span>Includes Certification</span>
            </label>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveNewCourse()">Add Course</button>
    `;

    openModal('Add New Course', html, footer);
}

function saveNewCourse() {
    const title = document.getElementById('newCourseTitle').value.trim();
    if (!title) {
        alert('Please enter a course title');
        return;
    }

    const newCourse = {
        id: nextCourseId++,
        title: title,
        provider: document.getElementById('newCourseProvider').value.trim() || 'Unknown Provider',
        providerType: 'MOOC',
        url: document.getElementById('newCourseUrl').value.trim(),
        description: document.getElementById('newCourseDescription').value.trim(),
        format: document.getElementById('newCourseFormat').value,
        duration: {
            totalHours: parseFloat(document.getElementById('newCourseDuration').value) || 0,
            weeksToComplete: 0,
            hoursPerWeek: 0
        },
        location: '',
        language: 'English',
        cost: parseFloat(document.getElementById('newCourseCost').value) || 0,
        costCurrency: settings.currency,
        costNotes: '',
        rating: parseFloat(document.getElementById('newCourseRating').value) || 0,
        ratingCount: 0,
        sentiment: 'Good',
        sentimentSummary: '',
        skillLevel: document.getElementById('newCourseLevel').value,
        keyTopics: [],
        learningObjectives: [],
        prerequisites: [],
        hasCertification: document.getElementById('newCourseCert').checked,
        certificationName: '',
        certificationBody: '',
        certificationValidityYears: 0,
        relevantCompetencies: [],
        discoveredBy: 'Manual Entry',
        discoveryDate: new Date().toISOString(),
        discoveryContext: '',
        timesAssigned: 0,
        completionRate: 0,
        averageRating: 0,
        isActive: true,
        isRecommended: false,
        isDeprecated: false,
        deprecationNote: '',
        createdDate: new Date().toISOString(),
        lastModified: new Date().toISOString(),
        lastVerified: new Date().toISOString()
    };

    courseCatalog.push(newCourse);
    closeModal();
    triggerSave();
    renderCourses();
}

function viewCourseDetail(courseId) {
    const course = courseCatalog.find(c => c.id === courseId);
    if (!course) return;

    const html = `
        <div>
            <h3>${course.title}</h3>
            <p><strong>Provider:</strong> ${course.provider}</p>
            <p><strong>Cost:</strong> ${formatCurrency(course.cost)}</p>
            <p><strong>Duration:</strong> ${course.duration.totalHours} hours</p>
            <p><strong>Format:</strong> ${course.format}</p>
            <p><strong>Level:</strong> ${course.skillLevel}</p>
            <p><strong>Rating:</strong> ${'⭐'.repeat(Math.round(course.rating || 0))} ${course.rating ? course.rating.toFixed(1) : 'No rating'}</p>
            ${course.hasCertification ? '<p><strong>Certification:</strong> ✓ Includes certification</p>' : ''}
            ${course.url ? `<p><strong>URL:</strong> <a href="${course.url}" target="_blank">View Course</a></p>` : ''}
            ${course.description ? `<p><strong>Description:</strong> ${course.description}</p>` : ''}
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Close</button>
        <button class="btn btn-error" onclick="deleteCourse(${courseId})">Delete</button>
    `;

    openModal(`Course: ${course.title}`, html, footer);
}

function deleteCourse(courseId) {
    if (settings.confirmBeforeDelete) {
        if (!confirm('Are you sure you want to delete this course?')) {
            return;
        }
    }

    const index = courseCatalog.findIndex(c => c.id === courseId);
    if (index > -1) {
        courseCatalog.splice(index, 1);
        closeModal();
        triggerSave();
        renderCourses();
    }
}

// === TRAINING PLANS (TAB 5) ===
function renderTrainingPlans() {
    const content = document.getElementById('trainingPlansContent');

    if (wizardState.active) {
        content.innerHTML = renderWizard();
        return;
    }

    const html = `
        <div class="card-header mb-2">
            <h2 class="card-title">Training Plans</h2>
            <button class="btn btn-primary" onclick="startNewPlan()">+ Create Training Plan</button>
        </div>

        <div id="plansList">
            ${renderPlansList()}
        </div>
    `;

    content.innerHTML = html;
}

function renderPlansList() {
    if (trainingPlans.length === 0) {
        return `<div class="empty-state">
            <div class="empty-state-icon">📋</div>
            <div class="empty-state-title">No Training Plans Yet</div>
            <div class="empty-state-description">Create your first AI-assisted training plan.</div>
            <button class="btn btn-primary" onclick="startNewPlan()">+ Create Training Plan</button>
        </div>`;
    }

    let html = '<div class="grid-auto">';

    trainingPlans.forEach(plan => {
        const resource = resources.find(r => r.id === plan.resourceId);
        const resourceName = resource ? resource.name : 'Unknown';

        html += `
            <div class="card">
                <div class="card-header">
                    <div>
                        <h3 class="card-title">${escapeHtml(plan.planName)}</h3>
                        <div class="card-subtitle">${resourceName}</div>
                    </div>
                    ${getStatusBadge(plan.status)}
                </div>
                <div class="card-body">
                    <p>${escapeHtml(plan.planDescription || 'No description')}</p>
                    <div style="margin-top: 12px;">
                        <strong>Period:</strong> ${formatDate(plan.planPeriod?.startDate)} - ${formatDate(plan.planPeriod?.endDate)}
                    </div>
                    <div><strong>Budget:</strong> ${formatCurrency(plan.allocatedBudget || 0)}</div>
                    <div><strong>Courses:</strong> ${plan.scheduledCourses?.length || 0}</div>
                </div>
            </div>
        `;
    });

    html += '</div>';
    return html;
}

function startNewPlan() {
    wizardState = {
        active: true,
        currentStep: 1,
        totalSteps: 6,
        data: {
            resourceId: null,
            competencies: [],
            goals: [],
            selectedCourses: [],
            schedule: [],
            planDetails: {}
        }
    };
    renderTrainingPlans();
}

function renderWizard() {
    const steps = ['Select Resource', 'Assess', 'Goals', 'Discover', 'Schedule', 'Review'];

    let html = `
        <div class="wizard-container">
            <div class="wizard-header">
                <h2 class="wizard-title">Create Training Plan</h2>
                <p class="wizard-subtitle">Step ${wizardState.currentStep} of ${wizardState.totalSteps}</p>
            </div>

            <div class="wizard-progress">
    `;

    for (let i = 1; i <= wizardState.totalSteps; i++) {
        const isActive = i === wizardState.currentStep;
        const isCompleted = i < wizardState.currentStep;
        const stepClass = isActive ? 'active' : isCompleted ? 'completed' : '';

        html += `
            <div class="wizard-step ${stepClass}">
                <div class="wizard-step-circle">${isCompleted ? '✓' : i}</div>
                <div class="wizard-step-label">${steps[i-1]}</div>
                ${i < wizardState.totalSteps ? '<div class="wizard-step-line"></div>' : ''}
            </div>
        `;
    }

    html += `
            </div>

            <div class="wizard-content">
                ${renderWizardStep(wizardState.currentStep)}
            </div>

            <div class="wizard-navigation">
                <div>
                    ${wizardState.currentStep > 1 ? '<button class="btn btn-ghost" onclick="wizardPreviousStep()">← Back</button>' : '<button class="btn btn-ghost" onclick="wizardCancel()">Cancel</button>'}
                </div>
                <div>
                    ${wizardState.currentStep < wizardState.totalSteps ? '<button class="btn btn-primary" onclick="wizardNextStep()">Next →</button>' : '<button class="btn btn-success" onclick="wizardFinish()">Finish</button>'}
                </div>
            </div>
        </div>
    `;

    return html;
}

function renderWizardStep(step) {
    switch(step) {
        case 1: return renderWizardStep1();
        case 2: return renderWizardStep2();
        case 3: return renderWizardStep3();
        case 4: return renderWizardStep4();
        case 5: return renderWizardStep5();
        case 6: return renderWizardStep6();
        default: return '<p>Invalid step</p>';
    }
}

function renderWizardStep1() {
    let html = `
        <h3>Select Team Member</h3>
        <p style="margin-bottom: 20px;">Choose the resource for this training plan.</p>
    `;

    if (resources.length === 0) {
        return html + '<div class="alert alert-warning">No resources available. Please add a resource first.</div>';
    }

    html += '<div style="max-height: 400px; overflow-y: auto;">';

    resources.forEach(resource => {
        const isSelected = wizardState.data.resourceId === resource.id;
        html += `
            <div class="list-item" onclick="selectWizardResource(${resource.id})" style="cursor: pointer; ${isSelected ? 'background: var(--bg-selected);' : ''}">
                <div>
                    <div class="list-item-title">${escapeHtml(resource.name)}</div>
                    <div class="list-item-subtitle">${escapeHtml(resource.jobTitle || '')} • ${escapeHtml(resource.location || '')}</div>
                </div>
                ${isSelected ? '<span class="badge badge-success">Selected</span>' : ''}
            </div>
        `;
    });

    html += '</div>';
    return html;
}

function selectWizardResource(resourceId) {
    wizardState.data.resourceId = resourceId;
    renderTrainingPlans();
}

function renderWizardStep2() {
    const resource = resources.find(r => r.id === wizardState.data.resourceId);
    if (!resource) return '<p>Resource not found</p>';

    return `
        <h3>Assess Competencies</h3>
        <p>Current competencies for ${resource.name}</p>

        <div class="alert alert-info">
            <strong>AI Assessment Available:</strong> Use AI to analyze the resource's job role and suggest competencies.
            ${settings.apiKey ? '' : '<br><em>Configure your API key in Settings first.</em>'}
        </div>

        <div style="margin-top: 20px;">
            <p>Current competencies: ${resource.currentCompetencies.length}</p>
            <p>You can continue to define goals in the next step.</p>
        </div>
    `;
}

function renderWizardStep3() {
    const resource = resources.find(r => r.id === wizardState.data.resourceId);
    if (!resource) return '<p>Resource not found</p>';

    return `
        <h3>Define Training Goals</h3>
        <p>What should ${resource.name} achieve through training?</p>

        <div class="alert alert-info">
            <strong>AI Suggestions Available:</strong> Get AI-powered goal recommendations based on career progression and team needs.
        </div>

        <div style="margin-top: 20px;">
            <p>Desired competencies: ${resource.desiredCompetencies.length}</p>
            <p>Continue to discover courses that match these goals.</p>
        </div>
    `;
}

function renderWizardStep4() {
    return `
        <h3>Discover Training Courses</h3>
        <p>Find courses that match the training goals.</p>

        <div class="alert alert-info">
            <strong>AI Course Discovery:</strong> Let AI search and recommend the best courses from across the web.
            ${settings.apiKey ? '' : '<br><em>Configure your API key in Settings first.</em>'}
        </div>

        <div style="margin-top: 20px;">
            <p>Selected courses: ${wizardState.data.selectedCourses.length}</p>
            <p>You can also browse the course catalog and select courses manually.</p>
        </div>
    `;
}

function renderWizardStep5() {
    return `
        <h3>Schedule Training</h3>
        <p>Optimize the training schedule based on availability and constraints.</p>

        <div class="alert alert-info">
            <strong>AI Schedule Optimization:</strong> Let AI create an optimal schedule considering holidays, workload, and learning pace.
        </div>

        <div style="margin-top: 20px;">
            <p>Proceed to review the complete training plan.</p>
        </div>
    `;
}

function renderWizardStep6() {
    const resource = resources.find(r => r.id === wizardState.data.resourceId);
    if (!resource) return '<p>Resource not found</p>';

    return `
        <h3>Review Training Plan</h3>
        <p>Review and approve the training plan for ${resource.name}</p>

        <div style="background: var(--neutral-50); padding: 20px; border-radius: var(--radius-lg); margin-top: 20px;">
            <h4>Plan Summary</h4>
            <p><strong>Resource:</strong> ${resource.name}</p>
            <p><strong>Current Competencies:</strong> ${resource.currentCompetencies.length}</p>
            <p><strong>Training Goals:</strong> ${resource.desiredCompetencies.length}</p>
            <p><strong>Selected Courses:</strong> ${wizardState.data.selectedCourses.length}</p>
            <p><strong>Estimated Budget:</strong> ${formatCurrency(0)}</p>
        </div>

        <div class="alert alert-success" style="margin-top: 20px;">
            Click "Finish" to create this training plan.
        </div>
    `;
}

function wizardNextStep() {
    if (wizardState.currentStep === 1 && !wizardState.data.resourceId) {
        alert('Please select a resource');
        return;
    }

    if (wizardState.currentStep < wizardState.totalSteps) {
        wizardState.currentStep++;
        renderTrainingPlans();
    }
}

function wizardPreviousStep() {
    if (wizardState.currentStep > 1) {
        wizardState.currentStep--;
        renderTrainingPlans();
    }
}

function wizardCancel() {
    if (confirm('Are you sure you want to cancel? Progress will be lost.')) {
        wizardState.active = false;
        renderTrainingPlans();
    }
}

function wizardFinish() {
    const resource = resources.find(r => r.id === wizardState.data.resourceId);
    if (!resource) return;

    const newPlan = {
        id: nextPlanId++,
        resourceId: resource.id,
        planName: `${resource.name} Training Plan ${new Date().getFullYear()}`,
        planDescription: 'AI-assisted training plan',
        planPeriod: {
            startDate: new Date().toISOString().split('T')[0],
            endDate: new Date(Date.now() + 180*24*60*60*1000).toISOString().split('T')[0]
        },
        primaryObjective: 'Skill development and career growth',
        desiredOutcomes: [],
        successMetrics: [],
        allocatedBudget: resource.annualTrainingBudget || 0,
        projectedSpend: 0,
        contingencyBuffer: 0,
        scheduledCourses: [],
        gapAnalysis: {
            criticalGaps: [],
            levelGaps: [],
            estimatedTimeToClose: 0
        },
        aiRecommendations: {},
        status: 'Draft',
        approvedDate: null,
        approvedBy: null,
        createdDate: new Date().toISOString(),
        lastModified: new Date().toISOString(),
        version: 1
    };

    trainingPlans.push(newPlan);
    wizardState.active = false;
    triggerSave();
    renderTrainingPlans();

    openModal('Success', `
        <div class="alert alert-success">
            Training plan created successfully for ${resource.name}!
        </div>
    `);
}

// === CALENDARS (TAB 6) ===
function renderCalendars() {
    const content = document.getElementById('calendarsContent');

    const html = `
        <div class="card-header mb-2">
            <h2 class="card-title">Regional Calendars</h2>
            <button class="btn btn-primary" onclick="showAddCalendarForm()">+ Add Calendar</button>
        </div>

        <div id="calendarsList">
            ${renderCalendarsList()}
        </div>
    `;

    content.innerHTML = html;
}

function renderCalendarsList() {
    if (regionalCalendars.length === 0) {
        return `<div class="empty-state">
            <div class="empty-state-icon">📅</div>
            <div class="empty-state-title">No Calendars Yet</div>
            <div class="empty-state-description">Add regional calendars to track holidays and plan training schedules.</div>
            <button class="btn btn-primary" onclick="showAddCalendarForm()">+ Add Calendar</button>
        </div>`;
    }

    let html = '<div class="table-container"><table><thead><tr>';
    html += '<th>Name</th><th>Region</th><th>Year</th><th>Holidays</th><th>Used By</th><th>Actions</th>';
    html += '</tr></thead><tbody>';

    regionalCalendars.forEach(cal => {
        const useCount = resources.filter(r => r.regionalCalendarId === cal.id).length;

        html += `
            <tr>
                <td><strong>${escapeHtml(cal.name)}</strong></td>
                <td>${escapeHtml(cal.region)}</td>
                <td>${cal.year}</td>
                <td>${cal.holidays?.length || 0}</td>
                <td>${useCount} resources</td>
                <td class="table-actions">
                    <button class="btn btn-sm btn-ghost" onclick="viewCalendarDetail(${cal.id})">View</button>
                    <button class="btn btn-sm btn-ghost" onclick="deleteCalendar(${cal.id})">Delete</button>
                </td>
            </tr>
        `;
    });

    html += '</tbody></table></div>';
    return html;
}

function showAddCalendarForm() {
    const html = `
        <div class="form-group">
            <label class="form-label form-label-required">Name</label>
            <input type="text" class="form-input" id="newCalName" placeholder="US Federal Holidays">
        </div>

        <div class="form-inline">
            <div class="form-group">
                <label class="form-label">Region</label>
                <input type="text" class="form-input" id="newCalRegion" placeholder="US">
            </div>

            <div class="form-group">
                <label class="form-label">Year</label>
                <input type="number" class="form-input" id="newCalYear" value="${new Date().getFullYear()}" min="2020">
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="newCalDescription" placeholder="Calendar description..."></textarea>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveNewCalendar()">Add Calendar</button>
    `;

    openModal('Add New Calendar', html, footer);
}

function saveNewCalendar() {
    const name = document.getElementById('newCalName').value.trim();
    if (!name) {
        alert('Please enter a name');
        return;
    }

    const newCal = {
        id: nextCalendarId++,
        name: name,
        region: document.getElementById('newCalRegion').value.trim() || 'Custom',
        description: document.getElementById('newCalDescription').value.trim(),
        year: parseInt(document.getElementById('newCalYear').value) || new Date().getFullYear(),
        holidays: [],
        isTemplate: false,
        useCount: 0,
        createdDate: new Date().toISOString(),
        lastModified: new Date().toISOString()
    };

    regionalCalendars.push(newCal);
    closeModal();
    triggerSave();
    renderCalendars();
}

function viewCalendarDetail(calendarId) {
    const cal = regionalCalendars.find(c => c.id === calendarId);
    if (!cal) return;

    const html = `
        <div>
            <h3>${cal.name}</h3>
            <p><strong>Region:</strong> ${cal.region}</p>
            <p><strong>Year:</strong> ${cal.year}</p>
            <p><strong>Holidays:</strong> ${cal.holidays.length}</p>
            <p><strong>Description:</strong> ${cal.description || 'No description'}</p>
        </div>
    `;

    const footer = `
        <button class="btn btn-ghost" onclick="closeModal()">Close</button>
        <button class="btn btn-error" onclick="deleteCalendar(${calendarId})">Delete</button>
    `;

    openModal(`Calendar: ${cal.name}`, html, footer);
}

function deleteCalendar(calendarId) {
    const useCount = resources.filter(r => r.regionalCalendarId === calendarId).length;

    if (useCount > 0 && settings.confirmBeforeDelete) {
        if (!confirm(`This calendar is used by ${useCount} resources. Continue?`)) {
            return;
        }
    }

    const index = regionalCalendars.findIndex(c => c.id === calendarId);
    if (index > -1) {
        regionalCalendars.splice(index, 1);
        closeModal();
        triggerSave();
        renderCalendars();
    }
}

// === REPORTS (TAB 7) ===
function renderReports() {
    const content = document.getElementById('reportsContent');

    const html = `
        <h2 class="mb-2">Reports & Analytics</h2>

        <div class="grid-2">
            <div class="card">
                <h3 class="card-title">Budget Utilization</h3>
                <div class="card-body">
                    ${renderBudgetReport()}
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Training Progress</h3>
                <div class="card-body">
                    ${renderProgressReport()}
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Competency Gap Analysis</h3>
                <div class="card-body">
                    ${renderGapAnalysis()}
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Course Effectiveness</h3>
                <div class="card-body">
                    ${renderCourseEffectiveness()}
                </div>
            </div>
        </div>

        <div class="card mt-2">
            <h3 class="card-title">Data Management</h3>
            <div class="card-body">
                <div class="quick-actions">
                    <button class="btn btn-secondary" onclick="exportToJSON()">📥 Export to JSON</button>
                    <button class="btn btn-secondary" onclick="importFromJSON()">📤 Import from JSON</button>
                    <button class="btn btn-secondary" onclick="exportToExcel()">📊 Export to Excel</button>
                    <button class="btn btn-warning" onclick="loadSampleData()">🔄 Load Sample Data</button>
                    <button class="btn btn-error" onclick="clearAllData()">🗑️ Clear All Data</button>
                </div>
            </div>
        </div>
    `;

    content.innerHTML = html;
}

function renderBudgetReport() {
    const totalBudget = resources.reduce((sum, r) => sum + (r.annualTrainingBudget || 0), 0);
    const totalSpent = resources.reduce((sum, r) => sum + (r.budgetSpent || 0), 0);
    const remaining = totalBudget - totalSpent;
    const utilization = totalBudget > 0 ? Math.round((totalSpent / totalBudget) * 100) : 0;

    return `
        <div style="margin-bottom: 20px;">
            <div class="progress-labeled">
                <div class="progress-bar" style="flex: 1;">
                    <div class="progress-fill" style="width: ${utilization}%"></div>
                </div>
                <div class="progress-label">${utilization}%</div>
            </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
            <div>
                <div style="font-size: 12px; color: var(--text-muted);">Total Budget</div>
                <div style="font-size: 20px; font-weight: 600;">${formatCurrency(totalBudget)}</div>
            </div>
            <div>
                <div style="font-size: 12px; color: var(--text-muted);">Spent</div>
                <div style="font-size: 20px; font-weight: 600;">${formatCurrency(totalSpent)}</div>
            </div>
            <div>
                <div style="font-size: 12px; color: var(--text-muted);">Remaining</div>
                <div style="font-size: 20px; font-weight: 600;">${formatCurrency(remaining)}</div>
            </div>
        </div>
    `;
}

function renderProgressReport() {
    let totalCourses = 0;
    let completedCourses = 0;

    resources.forEach(r => {
        if (r.assignedCourses) {
            totalCourses += r.assignedCourses.length;
            completedCourses += r.assignedCourses.filter(c => c.status === 'Completed').length;
        }
    });

    const completionRate = totalCourses > 0 ? Math.round((completedCourses / totalCourses) * 100) : 0;

    return `
        <div style="margin-bottom: 20px;">
            <div class="progress-labeled">
                <div class="progress-bar progress-bar-success" style="flex: 1;">
                    <div class="progress-fill" style="width: ${completionRate}%"></div>
                </div>
                <div class="progress-label">${completionRate}%</div>
            </div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div>
                <div style="font-size: 12px; color: var(--text-muted);">Total Courses</div>
                <div style="font-size: 20px; font-weight: 600;">${totalCourses}</div>
            </div>
            <div>
                <div style="font-size: 12px; color: var(--text-muted);">Completed</div>
                <div style="font-size: 20px; font-weight: 600;">${completedCourses}</div>
            </div>
        </div>
    `;
}

function renderGapAnalysis() {
    const totalGaps = resources.reduce((sum, r) => sum + (r.desiredCompetencies?.length || 0), 0);

    return `
        <div>
            <p style="font-size: 28px; font-weight: 600; text-align: center; margin: 20px 0;">
                ${totalGaps}
            </p>
            <p style="text-align: center; color: var(--text-muted);">
                Competency gaps to close
            </p>
        </div>
    `;
}

function renderCourseEffectiveness() {
    return `
        <div>
            <p style="text-align: center; color: var(--text-muted); padding: 40px 20px;">
                Course effectiveness metrics will be calculated as team members complete courses and provide feedback.
            </p>
        </div>
    `;
}

// === IMPORT/EXPORT FUNCTIONS ===
function exportToJSON() {
    const exportData = {
        version: '1.0.0',
        exportDate: new Date().toISOString(),
        resources: resources,
        competencyLibrary: competencyLibrary,
        courseCatalog: courseCatalog,
        regionalCalendars: regionalCalendars,
        trainingPlans: trainingPlans,
        settings: settings
    };

    const dataStr = JSON.stringify(exportData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);

    const link = document.createElement('a');
    link.href = url;
    link.download = `training-plan-manager-export-${new Date().toISOString().split('T')[0]}.json`;
    link.click();

    URL.revokeObjectURL(url);

    openModal('Export Complete', `
        <div class="alert alert-success">
            Your data has been exported successfully!
        </div>
        <p>The file has been downloaded to your computer.</p>
    `);
}

function importFromJSON() {
    const input = document.getElementById('fileInput');
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const importData = JSON.parse(event.target.result);

                // Validate data structure
                if (!importData.resources || !Array.isArray(importData.resources)) {
                    throw new Error('Invalid data format');
                }

                if (!confirm('This will replace all current data. Are you sure?')) {
                    return;
                }

                // Import data
                resources = importData.resources || [];
                competencyLibrary = importData.competencyLibrary || [];
                courseCatalog = importData.courseCatalog || [];
                regionalCalendars = importData.regionalCalendars || [];
                trainingPlans = importData.trainingPlans || [];
                if (importData.settings) {
                    settings = { ...settings, ...importData.settings };
                }

                // Update IDs
                nextResourceId = Math.max(...resources.map(r => r.id), 0) + 1;
                nextCompetencyId = Math.max(...competencyLibrary.map(c => c.id), 0) + 1;
                nextCourseId = Math.max(...courseCatalog.map(c => c.id), 0) + 1;
                nextCalendarId = Math.max(...regionalCalendars.map(c => c.id), 0) + 1;
                nextPlanId = Math.max(...trainingPlans.map(p => p.id), 0) + 1;

                triggerSave();
                renderAllViews();

                openModal('Import Complete', `
                    <div class="alert alert-success">
                        Your data has been imported successfully!
                    </div>
                    <p>Imported: ${resources.length} resources, ${competencyLibrary.length} competencies, ${courseCatalog.length} courses</p>
                `);
            } catch (error) {
                openModal('Import Failed', `
                    <div class="alert alert-error">
                        Failed to import data: ${error.message}
                    </div>
                `);
            }
        };
        reader.readAsText(file);
    };
    input.click();
}

function exportToExcel() {
    if (typeof XLSX === 'undefined') {
        alert('Excel export library not loaded');
        return;
    }

    // Create workbook
    const wb = XLSX.utils.book_new();

    // Resources sheet
    const resourcesData = resources.map(r => ({
        'Name': r.name,
        'Job Title': r.jobTitle || '',
        'Department': r.department || '',
        'Location': r.location || '',
        'Email': r.email || '',
        'Budget': r.annualTrainingBudget || 0,
        'Budget Spent': r.budgetSpent || 0,
        'Competencies': r.currentCompetencies?.length || 0,
        'Courses': r.assignedCourses?.length || 0
    }));
    const resourcesSheet = XLSX.utils.json_to_sheet(resourcesData);
    XLSX.utils.book_append_sheet(wb, resourcesSheet, 'Resources');

    // Competencies sheet
    const competenciesData = competencyLibrary.map(c => ({
        'Name': c.name,
        'Category': c.category || '',
        'Subcategory': c.subcategory || '',
        'Description': c.description || ''
    }));
    const competenciesSheet = XLSX.utils.json_to_sheet(competenciesData);
    XLSX.utils.book_append_sheet(wb, competenciesSheet, 'Competencies');

    // Courses sheet
    const coursesData = courseCatalog.map(c => ({
        'Title': c.title,
        'Provider': c.provider,
        'Cost': c.cost || 0,
        'Duration (hrs)': c.duration?.totalHours || 0,
        'Format': c.format,
        'Level': c.skillLevel,
        'Rating': c.rating || 0,
        'Certification': c.hasCertification ? 'Yes' : 'No'
    }));
    const coursesSheet = XLSX.utils.json_to_sheet(coursesData);
    XLSX.utils.book_append_sheet(wb, coursesSheet, 'Courses');

    // Training Plans sheet
    const plansData = trainingPlans.map(p => {
        const resource = resources.find(r => r.id === p.resourceId);
        return {
            'Plan Name': p.planName,
            'Resource': resource ? resource.name : 'Unknown',
            'Status': p.status,
            'Budget': p.allocatedBudget || 0,
            'Courses': p.scheduledCourses?.length || 0,
            'Start Date': p.planPeriod?.startDate || '',
            'End Date': p.planPeriod?.endDate || ''
        };
    });
    const plansSheet = XLSX.utils.json_to_sheet(plansData);
    XLSX.utils.book_append_sheet(wb, plansSheet, 'Training Plans');

    // Write file
    XLSX.writeFile(wb, `training-plan-manager-export-${new Date().toISOString().split('T')[0]}.xlsx`);

    openModal('Export Complete', `
        <div class="alert alert-success">
            Excel file exported successfully!
        </div>
    `);
}

function clearAllData() {
    if (!confirm('Are you SURE you want to delete ALL data? This cannot be undone!')) {
        return;
    }

    if (!confirm('Final confirmation: This will permanently delete all resources, competencies, courses, calendars, and training plans.')) {
        return;
    }

    resources = [];
    competencyLibrary = [];
    courseCatalog = [];
    regionalCalendars = [];
    trainingPlans = [];

    nextResourceId = 1;
    nextCompetencyId = 1;
    nextCourseId = 1;
    nextCalendarId = 1;
    nextPlanId = 1;

    triggerSave();
    renderAllViews();

    openModal('Data Cleared', `
        <div class="alert alert-success">
            All data has been cleared. You can load sample data to get started.
        </div>
    `);
}

// === AI INTEGRATION ===
async function callClaudeAPI(systemPrompt, userPrompt) {
    if (!settings.apiKey) {
        throw new Error('API key not configured. Please add your API key in Settings.');
    }

    const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
            'x-api-key': settings.apiKey,
            'anthropic-version': '2023-06-01',
            'content-type': 'application/json'
        },
        body: JSON.stringify({
            model: settings.aiModel || 'claude-3-5-sonnet-20241022',
            max_tokens: 4096,
            temperature: settings.aiTemperature || 0.7,
            system: systemPrompt,
            messages: [{ role: 'user', content: userPrompt }]
        })
    });

    if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error?.message || 'AI API request failed');
    }

    const data = await response.json();
    return data.content[0].text;
}

async function analyzeCompetenciesWithAI(resourceData) {
    const systemPrompt = `You are an expert HR consultant specializing in technical competency assessment.
Analyze the provided job role and suggest relevant technical competencies with proficiency levels.
Return your response as a JSON array of objects with: name, category, currentLevel (1-5), rationale.`;

    const userPrompt = `Analyze this role and suggest 5-8 key competencies:
Job Title: ${resourceData.jobTitle}
Department: ${resourceData.department}
Additional context: ${resourceData.context || 'None'}`;

    try {
        const response = await callClaudeAPI(systemPrompt, userPrompt);
        return JSON.parse(response);
    } catch (error) {
        console.error('AI analysis failed:', error);
        throw error;
    }
}

async function suggestGoalsWithAI(resource, currentCompetencies) {
    const systemPrompt = `You are a career development advisor. Based on the resource's current competencies and role,
suggest training goals that will help them advance in their career. Return JSON array with: competencyName,
targetLevel (1-5), priority (Critical/High/Medium/Low), rationale.`;

    const userPrompt = `Suggest 3-5 training goals for:
Name: ${resource.name}
Title: ${resource.jobTitle}
Current Competencies: ${JSON.stringify(currentCompetencies)}`;

    try {
        const response = await callClaudeAPI(systemPrompt, userPrompt);
        return JSON.parse(response);
    } catch (error) {
        console.error('AI goal suggestions failed:', error);
        throw error;
    }
}

async function discoverCoursesWithAI(goals, constraints) {
    const systemPrompt = `You are a training course advisor. Search for and recommend training courses
that match the specified goals and constraints. Return JSON array with: title, provider, cost, duration,
url, format, skillLevel, relevanceScore (1-10), rationale.`;

    const userPrompt = `Find courses for these goals:
Goals: ${JSON.stringify(goals)}
Budget: ${constraints.budget}
Format Preference: ${constraints.format}
Location: ${constraints.location}`;

    try {
        const response = await callClaudeAPI(systemPrompt, userPrompt);
        return JSON.parse(response);
    } catch (error) {
        console.error('AI course discovery failed:', error);
        throw error;
    }
}

// === SAMPLE DATA ===
function loadSampleData() {
    if (!confirm('This will replace all existing data with sample data. Continue?')) {
        return;
    }

    // Clear existing
    resources = [];
    competencyLibrary = [];
    courseCatalog = [];
    regionalCalendars = [];
    trainingPlans = [];

    // Reset IDs
    nextResourceId = 1;
    nextCompetencyId = 1;
    nextCourseId = 1;
    nextCalendarId = 1;
    nextPlanId = 1;

    // Load sample data
    loadSampleCompetencies();
    loadSampleCourses();
    loadSampleCalendars();
    loadSampleResources();

    triggerSave();
    renderAllViews();

    openModal('Sample Data Loaded', `
        <div class="alert alert-success">
            Sample data has been loaded successfully!
        </div>
        <p>Loaded: ${resources.length} resources, ${competencyLibrary.length} competencies, ${courseCatalog.length} courses</p>
    `);
}

function loadSampleCompetencies() {
    const sampleCompetencies = [
        { name: 'Python Programming', category: 'Programming Languages', subcategory: 'Backend Development' },
        { name: 'JavaScript/TypeScript', category: 'Programming Languages', subcategory: 'Full Stack Development' },
        { name: 'Java Development', category: 'Programming Languages', subcategory: 'Enterprise Development' },
        { name: 'Go Programming', category: 'Programming Languages', subcategory: 'Backend Development' },
        { name: 'AWS Cloud', category: 'Cloud Platforms', subcategory: 'Public Cloud' },
        { name: 'Azure Cloud', category: 'Cloud Platforms', subcategory: 'Public Cloud' },
        { name: 'Google Cloud Platform', category: 'Cloud Platforms', subcategory: 'Public Cloud' },
        { name: 'Kubernetes', category: 'Cloud Platforms', subcategory: 'Container Orchestration' },
        { name: 'Docker', category: 'DevOps', subcategory: 'Containerization' },
        { name: 'CI/CD Pipelines', category: 'DevOps', subcategory: 'Automation' },
        { name: 'Terraform', category: 'DevOps', subcategory: 'Infrastructure as Code' },
        { name: 'Security Best Practices', category: 'Security', subcategory: 'Application Security' },
        { name: 'OWASP Top 10', category: 'Security', subcategory: 'Web Security' },
        { name: 'SQL Databases', category: 'Data', subcategory: 'Databases' },
        { name: 'NoSQL Databases', category: 'Data', subcategory: 'Databases' },
        { name: 'Data Engineering', category: 'Data', subcategory: 'Data Pipelines' },
        { name: 'Leadership', category: 'Soft Skills', subcategory: 'Management' },
        { name: 'Technical Communication', category: 'Soft Skills', subcategory: 'Communication' }
    ];

    sampleCompetencies.forEach(comp => {
        competencyLibrary.push({
            id: nextCompetencyId++,
            name: comp.name,
            category: comp.category,
            subcategory: comp.subcategory,
            description: `Professional knowledge and skills in ${comp.name}`,
            levelDefinitions: {
                1: { name: 'Awareness', description: 'Basic understanding. Can follow documentation with guidance.' },
                2: { name: 'Beginner', description: 'Can perform basic tasks independently. Needs help with complex scenarios.' },
                3: { name: 'Intermediate', description: 'Handles most tasks independently. Good working knowledge.' },
                4: { name: 'Advanced', description: 'Expert-level skills. Handles complex scenarios confidently.' },
                5: { name: 'Expert', description: 'Industry-recognized expertise. Thought leader.' }
            },
            frameworkMappings: {},
            relatedCompetencies: [],
            prerequisites: [],
            useCount: 0,
            lastUsed: new Date().toISOString(),
            createdDate: new Date().toISOString(),
            lastModified: new Date().toISOString(),
            createdBy: 'System',
            isActive: true
        });
    });
}

function loadSampleCourses() {
    const sampleCourses = [
        { title: 'Complete Python Bootcamp', provider: 'Udemy', cost: 89, duration: 35, format: 'Online Self-Paced', level: 'Beginner', rating: 4.6, cert: false },
        { title: 'AWS Certified Solutions Architect', provider: 'A Cloud Guru', cost: 299, duration: 50, format: 'Online Self-Paced', level: 'Intermediate', rating: 4.7, cert: true },
        { title: 'Kubernetes for Developers', provider: 'Linux Foundation', cost: 299, duration: 40, format: 'Online Live', level: 'Intermediate', rating: 4.5, cert: true },
        { title: 'Advanced JavaScript Concepts', provider: 'Frontend Masters', cost: 390, duration: 15, format: 'Online Self-Paced', level: 'Advanced', rating: 4.8, cert: false },
        { title: 'Docker Mastery', provider: 'Udemy', cost: 89, duration: 25, format: 'Online Self-Paced', level: 'Intermediate', rating: 4.7, cert: false },
        { title: 'Terraform Associate Certification', provider: 'HashiCorp', cost: 495, duration: 45, format: 'Online Self-Paced', level: 'Intermediate', rating: 4.6, cert: true },
        { title: 'OWASP Top 10 Security', provider: 'SANS Institute', cost: 1500, duration: 40, format: 'Online Live', level: 'Advanced', rating: 4.9, cert: true },
        { title: 'Data Engineering Nanodegree', provider: 'Udacity', cost: 1200, duration: 120, format: 'Online Self-Paced', level: 'Intermediate', rating: 4.5, cert: true },
        { title: 'React Complete Guide', provider: 'Udemy', cost: 89, duration: 40, format: 'Online Self-Paced', level: 'Intermediate', rating: 4.7, cert: false },
        { title: 'Go Programming Language', provider: 'Pluralsight', cost: 299, duration: 30, format: 'Online Self-Paced', level: 'Beginner', rating: 4.6, cert: false },
        { title: 'Azure Fundamentals', provider: 'Microsoft Learn', cost: 0, duration: 25, format: 'Online Self-Paced', level: 'Beginner', rating: 4.5, cert: true },
        { title: 'Leadership for Tech Managers', provider: 'Coursera', cost: 200, duration: 20, format: 'Online Self-Paced', level: 'All Levels', rating: 4.4, cert: true }
    ];

    sampleCourses.forEach(course => {
        courseCatalog.push({
            id: nextCourseId++,
            title: course.title,
            provider: course.provider,
            providerType: 'MOOC',
            url: '',
            description: `Comprehensive training on ${course.title}`,
            format: course.format,
            duration: { totalHours: course.duration, weeksToComplete: 0, hoursPerWeek: 0 },
            location: '',
            language: 'English',
            cost: course.cost,
            costCurrency: 'USD',
            costNotes: '',
            rating: course.rating,
            ratingCount: Math.floor(Math.random() * 10000) + 1000,
            sentiment: 'Excellent',
            sentimentSummary: 'Highly recommended by learners',
            skillLevel: course.level,
            keyTopics: [],
            learningObjectives: [],
            prerequisites: [],
            hasCertification: course.cert,
            certificationName: course.cert ? `${course.title} Certificate` : '',
            certificationBody: course.cert ? course.provider : '',
            certificationValidityYears: course.cert ? 3 : 0,
            relevantCompetencies: [],
            discoveredBy: 'Sample Data',
            discoveryDate: new Date().toISOString(),
            discoveryContext: '',
            timesAssigned: 0,
            completionRate: 0,
            averageRating: 0,
            isActive: true,
            isRecommended: course.rating > 4.6,
            isDeprecated: false,
            deprecationNote: '',
            createdDate: new Date().toISOString(),
            lastModified: new Date().toISOString(),
            lastVerified: new Date().toISOString()
        });
    });
}

function loadSampleCalendars() {
    // US Federal Holidays
    regionalCalendars.push({
        id: nextCalendarId++,
        name: 'US Federal Holidays 2024',
        region: 'US',
        description: 'United States Federal Holidays',
        year: 2024,
        holidays: [
            { date: '2024-01-01', name: "New Year's Day", type: 'Public', isRecurring: true, recurringRule: 'January 1' },
            { date: '2024-01-15', name: 'Martin Luther King Jr. Day', type: 'Public', isRecurring: true, recurringRule: 'Third Monday of January' },
            { date: '2024-02-19', name: "Presidents' Day", type: 'Public', isRecurring: true, recurringRule: 'Third Monday of February' },
            { date: '2024-05-27', name: 'Memorial Day', type: 'Public', isRecurring: true, recurringRule: 'Last Monday of May' },
            { date: '2024-07-04', name: 'Independence Day', type: 'Public', isRecurring: true, recurringRule: 'July 4' },
            { date: '2024-09-02', name: 'Labor Day', type: 'Public', isRecurring: true, recurringRule: 'First Monday of September' },
            { date: '2024-11-28', name: 'Thanksgiving Day', type: 'Public', isRecurring: true, recurringRule: 'Fourth Thursday of November' },
            { date: '2024-12-25', name: 'Christmas Day', type: 'Public', isRecurring: true, recurringRule: 'December 25' }
        ],
        isTemplate: true,
        useCount: 0,
        createdDate: new Date().toISOString(),
        lastModified: new Date().toISOString()
    });

    // UK Bank Holidays
    regionalCalendars.push({
        id: nextCalendarId++,
        name: 'UK Bank Holidays 2024',
        region: 'UK',
        description: 'United Kingdom Bank Holidays',
        year: 2024,
        holidays: [
            { date: '2024-01-01', name: "New Year's Day", type: 'Public', isRecurring: true, recurringRule: 'January 1' },
            { date: '2024-03-29', name: 'Good Friday', type: 'Public', isRecurring: false, recurringRule: '' },
            { date: '2024-04-01', name: 'Easter Monday', type: 'Public', isRecurring: false, recurringRule: '' },
            { date: '2024-05-06', name: 'Early May Bank Holiday', type: 'Public', isRecurring: true, recurringRule: 'First Monday of May' },
            { date: '2024-05-27', name: 'Spring Bank Holiday', type: 'Public', isRecurring: true, recurringRule: 'Last Monday of May' },
            { date: '2024-08-26', name: 'Summer Bank Holiday', type: 'Public', isRecurring: true, recurringRule: 'Last Monday of August' },
            { date: '2024-12-25', name: 'Christmas Day', type: 'Public', isRecurring: true, recurringRule: 'December 25' },
            { date: '2024-12-26', name: 'Boxing Day', type: 'Public', isRecurring: true, recurringRule: 'December 26' }
        ],
        isTemplate: true,
        useCount: 0,
        createdDate: new Date().toISOString(),
        lastModified: new Date().toISOString()
    });
}

function loadSampleResources() {
    const sampleResourcesData = [
        { name: 'John Smith', title: 'Senior Developer', dept: 'Engineering', location: 'New York, USA', budget: 5000, spent: 2500 },
        { name: 'Jane Doe', title: 'Security Engineer', dept: 'Security', location: 'London, UK', budget: 4000, spent: 3800 },
        { name: 'Bob Wilson', title: 'DevOps Engineer', dept: 'Infrastructure', location: 'Remote', budget: 3000, spent: 500 },
        { name: 'Sarah Lee', title: 'QA Lead', dept: 'Quality', location: 'Singapore', budget: 5000, spent: 2000 },
        { name: 'Mike Chen', title: 'Data Engineer', dept: 'Data', location: 'San Francisco, USA', budget: 4500, spent: 1500 },
        { name: 'Emma Brown', title: 'Frontend Developer', dept: 'Engineering', location: 'Berlin, Germany', budget: 3500, spent: 1000 }
    ];

    sampleResourcesData.forEach((data, index) => {
        const resource = {
            id: nextResourceId++,
            name: data.name,
            email: `${data.name.toLowerCase().replace(' ', '.')}@company.com`,
            jobTitle: data.title,
            department: data.dept,
            location: data.location,
            hireDate: new Date(2020 + index, index % 12, 1).toISOString().split('T')[0],
            annualTrainingBudget: data.budget,
            budgetSpent: data.spent,
            budgetYear: new Date().getFullYear(),
            currentCompetencies: [],
            desiredCompetencies: [],
            weeklyTrainingHours: 5,
            preferredTrainingDays: ['Tuesday', 'Thursday'],
            learningPace: 'Moderate',
            formatPreference: 'Online',
            regionalCalendarId: data.location.includes('US') ? 1 : (data.location.includes('UK') ? 2 : null),
            personalTimeOff: [],
            blackoutPeriods: [],
            assignedCourses: [],
            notes: '',
            tags: [],
            createdDate: new Date().toISOString(),
            lastModified: new Date().toISOString(),
            createdBy: 'System'
        };

        // Add some sample competencies
        if (index === 0) { // John - Developer
            resource.currentCompetencies = [
                { competencyId: 1, currentLevel: 4, assessmentDate: new Date().toISOString(), assessedBy: 'Manager', notes: '' },
                { competencyId: 2, currentLevel: 3, assessmentDate: new Date().toISOString(), assessedBy: 'Manager', notes: '' }
            ];
            resource.desiredCompetencies = [
                { competencyId: 5, targetLevel: 3, priority: 'High', targetDate: '2024-06-30', rationale: 'Cloud migration project' }
            ];
        }

        resources.push(resource);
    });
}

</script>
</body>
</html>
